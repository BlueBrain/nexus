<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../.././assets/img/favicon-32x32.png">
<title>PostgreSQL · Blue Brain Nexus</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
<meta name="theme-color" content="#03a9f4" />
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../.././assets/css/docs.css">
</head>
<body
data-md-color-primary="light-blue"
data-md-color-accent="cyan"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../docs/index.html" title="Blue Brain Nexus" class="md-header-nav__button md-logo">
<img src="../.././assets/img/logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Blue Brain Nexus
</span>
<span class="md-header-nav__topic">
PostgreSQL
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/BlueBrain/nexus"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
BlueBrain/nexus
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../docs/index.html" title="Blue Brain Nexus" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../.././assets/img/logo.png" width="24" height="24">
</a>
<a href="../../docs/index.html" title="Blue Brain Nexus">
Blue Brain Nexus
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/BlueBrain/nexus"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
BlueBrain/nexus
</div>
</a>

</div>
<ul>
  <li><a href="../../docs/versions.html" class="page">Versions</a></li>
  <li><a href="../../docs/getting-started/index.html" class="page">Getting Started</a>
  <ul>
    <li><a href="../../docs/getting-started/understanding-knowledge-graphs.html" class="page">Understanding Knowledge Graphs</a></li>
    <li><a href="../../docs/getting-started/try-nexus.html" class="page">Try Nexus with Neuroscience Datasets</a></li>
    <li><a href="../../docs/getting-started/try-nexus-movielens.html" class="page">Try Nexus with the MovieLens Dataset</a></li>
  </ul></li>
  <li><a href="../../docs/running-nexus/index.html" class="page">Running Nexus</a>
  <ul>
    <li><a href="../../docs/running-nexus/postgresql.html" class="active page">PostgreSQL</a></li>
    <li><a href="../../docs/running-nexus/elasticsearch.html" class="page">Elasticsearch</a></li>
    <li><a href="../../docs/running-nexus/blazegraph.html" class="page">Blazegraph</a></li>
    <li><a href="../../docs/running-nexus/delta.html" class="page">Nexus Delta</a></li>
    <li><a href="../../docs/running-nexus/configuration/index.html" class="page">Nexus configuration</a></li>
    <li><a href="../../docs/running-nexus/search-configuration.html" class="page">Search configuration</a></li>
  </ul></li>
  <li><a href="../../docs/releases/index.html" class="page">Releases</a>
  <ul>
    <li><a href="../../docs/releases/v1.12-release-notes.html" class="page">v1.12 Release Notes</a></li>
    <li><a href="../../docs/releases/v1.11-to-v1.12-migration.html" class="page">v1.11 To v1.12 Migration</a></li>
    <li><a href="../../docs/releases/v1.11-release-notes.html" class="page">v1.11 Release Notes</a></li>
    <li><a href="../../docs/releases/v1.10-to-v1.11-migration.html" class="page">v1.10 To v1.11 Migration</a></li>
    <li><a href="../../docs/releases/v1.10-release-notes.html" class="page">v1.10 Release Notes</a></li>
    <li><a href="../../docs/releases/v1.9-to-v1.10-migration.html" class="page">v1.9 To v1.10 Migration</a></li>
    <li><a href="../../docs/releases/v1.9-release-notes.html" class="page">v1.9 Release Notes</a></li>
    <li><a href="../../docs/releases/v1.8-to-v1.9-migration.html" class="page">v1.8 To v1.9 Migration</a></li>
    <li><a href="../../docs/releases/v1.8-release-notes.html" class="page">v1.8 Release Notes</a></li>
    <li><a href="../../docs/releases/v1.7-to-v1.8-migration.html" class="page">v1.7 To v1.8 Migration</a></li>
    <li><a href="../../docs/releases/older-releases.html" class="page">Older releases</a></li>
  </ul></li>
  <li><a href="../../docs/fusion/index.html" class="page">Nexus Fusion</a>
  <ul>
    <li><a href="../../docs/fusion/architecture.html" class="page">Architecture</a></li>
    <li><a href="../../docs/fusion/organizations.html" class="page">Organizations</a></li>
    <li><a href="../../docs/fusion/projects.html" class="page">Projects</a>
    <ul>
      <li><a href="../../docs/fusion/project.html" class="page">Project</a></li>
    </ul></li>
    <li><a href="../../docs/fusion/search.html" class="page">Global Search Types</a></li>
    <li><a href="../../docs/fusion/studios.html" class="page">Studios</a>
    <ul>
      <li><a href="../../docs/fusion/studio.html" class="page">Studio</a></li>
    </ul></li>
    <li><a href="../../docs/fusion/my-data.html" class="page">User data</a></li>
    <li><a href="../../docs/fusion/plugins.html" class="page">Plugins</a></li>
  </ul></li>
  <li><a href="../../docs/forge.html" class="page">Nexus Forge</a></li>
  <li><a href="../../docs/delta/index.html" class="page">Nexus Delta</a>
  <ul>
    <li><a href="../../docs/delta/architecture.html" class="page">Architecture</a></li>
    <li><a href="../../docs/delta/api/index.html" class="page">API Reference</a>
    <ul>
      <li><a href="../../docs/delta/api/content-negotiation.html" class="page">Content Negotiation</a></li>
      <li><a href="../../docs/delta/api/conditional-requests.html" class="page">Conditional requests</a></li>
      <li><a href="../../docs/delta/api/error-signaling.html" class="page">Error Signaling</a></li>
      <li><a href="../../docs/delta/api/version.html" class="page">Version</a></li>
      <li><a href="../../docs/delta/api/authentication.html" class="page">Authentication &amp; Authorization</a></li>
      <li><a href="../../docs/delta/api/identities.html" class="page">Identities</a></li>
      <li><a href="../../docs/delta/api/permissions-api.html" class="page">Permissions</a></li>
      <li><a href="../../docs/delta/api/realms-api.html" class="page">Realms</a></li>
      <li><a href="../../docs/delta/api/acls-api.html" class="page">Access Control Lists</a></li>
      <li><a href="../../docs/delta/api/user-permissions-api.html" class="page">User Permissions</a></li>
      <li><a href="../../docs/delta/api/orgs-api.html" class="page">Organizations</a></li>
      <li><a href="../../docs/delta/api/projects-api.html" class="page">Projects</a></li>
      <li><a href="../../docs/delta/api/schemas-api.html" class="page">Schemas</a></li>
      <li><a href="../../docs/delta/api/resources-api.html" class="page">Resources</a></li>
      <li><a href="../../docs/delta/api/trial.html" class="page">Trial</a></li>
      <li><a href="../../docs/delta/api/multi-fetch.html" class="page">Multi fetch</a></li>
      <li><a href="../../docs/delta/api/id-resolution.html" class="page">Id Resolution</a></li>
      <li><a href="../../docs/delta/api/history.html" class="page">History of resources</a></li>
      <li><a href="../../docs/delta/api/resolvers-api.html" class="page">Resolvers</a></li>
      <li><a href="../../docs/delta/api/views/index.html" class="page">Views</a>
      <ul>
        <li><a href="../../docs/delta/api/views/elasticsearch-view-api.html" class="page">ElasticSearchView</a></li>
        <li><a href="../../docs/delta/api/views/pipes.html" class="page">Elasticsearch Pipes</a></li>
        <li><a href="../../docs/delta/api/views/aggregated-es-view-api.html" class="page">AggregateElasticSearchView</a></li>
        <li><a href="../../docs/delta/api/views/sparql-view-api.html" class="page">SparqlView</a></li>
        <li><a href="../../docs/delta/api/views/aggregated-sparql-view-api.html" class="page">AggregateSparqlView</a></li>
        <li><a href="../../docs/delta/api/views/composite-view-api.html" class="page">CompositeView</a></li>
      </ul></li>
      <li><a href="../../docs/delta/api/storages-api.html" class="page">Storages</a></li>
      <li><a href="../../docs/delta/api/files-api.html" class="page">Nexus metadata</a></li>
      <li><a href="../../docs/delta/api/archives-api.html" class="page">Archives</a></li>
      <li><a href="../../docs/delta/api/search-api.html" class="page">Global search</a></li>
      <li><a href="../../docs/delta/api/graph-analytics-api.html" class="page">Graph analytics</a></li>
      <li><a href="../../docs/delta/api/supervision-api.html" class="page">Supervision</a></li>
      <li><a href="../../docs/delta/api/type-hierarchy-api.html" class="page">Type hierarchy</a></li>
    </ul></li>
    <li><a href="../../docs/delta/metadata.html" class="page">Nexus Metadata</a></li>
    <li><a href="../../docs/delta/plugins/index.html" class="page">Plugins</a></li>
  </ul></li>
  <li><a href="../../docs/utilities/index.html" class="page">Utilities</a></li>
  <li><a href="../../docs/faq.html" class="page">FAQ</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../docs/running-nexus/postgresql.html#postgresql" class="header">PostgreSQL</a>
  <ul>
    <li><a href="../../docs/running-nexus/postgresql.html#postgresql-partitioning" class="header">PostgreSQL partitioning</a>
    <ul>
      <li><a href="../../docs/running-nexus/postgresql.html#list-partitioning" class="header">List partitioning</a></li>
      <li><a href="../../docs/running-nexus/postgresql.html#hash-partitioning" class="header">Hash partitioning</a></li>
      <li><a href="../../docs/running-nexus/postgresql.html#advanced-subpartitioning" class="header">Advanced subpartitioning</a></li>
    </ul></li>
    <li><a href="../../docs/running-nexus/postgresql.html#tables" class="header">Tables</a>
    <ul>
      <li><a href="../../docs/running-nexus/postgresql.html#initializing-the-schema" class="header">Initializing the schema</a></li>
      <li><a href="../../docs/running-nexus/postgresql.html#description" class="header">Description</a></li>
    </ul></li>
    <li><a href="../../docs/running-nexus/postgresql.html#running-and-monitoring" class="header">Running and monitoring</a></li>
    <li><a href="../../docs/running-nexus/postgresql.html#tools-and-resources" class="header">Tools and resources</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> Snapshot
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../docs/running-nexus/postgresql.html#postgresql" class="header">PostgreSQL</a>
  <ul>
    <li><a href="../../docs/running-nexus/postgresql.html#postgresql-partitioning" class="header">PostgreSQL partitioning</a>
    <ul>
      <li><a href="../../docs/running-nexus/postgresql.html#list-partitioning" class="header">List partitioning</a></li>
      <li><a href="../../docs/running-nexus/postgresql.html#hash-partitioning" class="header">Hash partitioning</a></li>
      <li><a href="../../docs/running-nexus/postgresql.html#advanced-subpartitioning" class="header">Advanced subpartitioning</a></li>
    </ul></li>
    <li><a href="../../docs/running-nexus/postgresql.html#tables" class="header">Tables</a>
    <ul>
      <li><a href="../../docs/running-nexus/postgresql.html#initializing-the-schema" class="header">Initializing the schema</a></li>
      <li><a href="../../docs/running-nexus/postgresql.html#description" class="header">Description</a></li>
    </ul></li>
    <li><a href="../../docs/running-nexus/postgresql.html#running-and-monitoring" class="header">Running and monitoring</a></li>
    <li><a href="../../docs/running-nexus/postgresql.html#tools-and-resources" class="header">Tools and resources</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="callout note warning admonition" style="visibility: visible; margin-top: 0px">
<div class="callout-title admonition-title">Snapshot version</div>
<p>
You are browsing the docs for the snapshot version of Nexus,
the latest release is available <a href="https://bluebrainnexus.io/docs/" title="here">here</a>
</p>
</div>
<div class="md-content__searchable">
<h1><a href="#postgresql" name="postgresql" class="anchor"><span class="anchor-link"></span></a>PostgreSQL</h1>
<p>Nexus uses <a href="https://www.postgresql.org/" title="PostgreSQL" target="_blank" rel="noopener noreferrer">PostgreSQL</a> as its <em>primary store</em> as for its strong reputation for performance, reliability and flexibility.</p>
<p>Since this is the <em>primary store</em> it is the most important system to be <a href="https://www.postgresql.org/docs/current/backup.html" title="backed up" target="_blank" rel="noopener noreferrer">backed up</a>. All of the data that Nexus uses in other stores can be recomputed from the one stored in PostgreSQL as the other stores are used as mere indexing systems.</p>
<h3><a href="#postgresql-partitioning" name="postgresql-partitioning" class="anchor"><span class="anchor-link"></span></a>PostgreSQL partitioning</h3>
<p>Nexus Delta takes advantage of PostgreSQL&rsquo;s <a href="https://www.postgresql.org/docs/current/ddl-partitioning.html" title="Table Partitioning">Table Partitioning</a> feature. This allows for improved query performance, and facilitates loading, deleting, or transferring data.</p>
<p>It currently supports 2 partition strategies offered by PostgreSQL:</p>
<ul>
  <li>List partitioning</li>
  <li>Hash partitioning</li>
</ul><div class="callout note warning"><div class="callout-title">Note</div>
<p>List partitioning is the default strategy.</p>
<p>Please be careful when configuring partitioning as Delta does not allow out-of-the box to adopt another one.</p></div>
<h4><a href="#list-partitioning" name="list-partitioning" class="anchor"><span class="anchor-link"></span></a>List partitioning</h4>
<p><strong>This strategy is best when you have a small number of projects which can contain a lot of resources.</strong></p>
<p>The <code>public.scoped_events</code> and <code>public.scoped_states</code> are partitioned by organization, which is itself partitioned by the projects it contains; this follows the natural hierarchy that can be found in Nexus Delta.</p>
<p>Nexus Delta takes care of handling the creation and deletion of the partitions.</p>
<ul>
  <li>If the created project is the first one of a given organization, both the organization partition and the project subpartition will be created.</li>
  <li>If the organization partition already exist, then only the project subpartition will be created upon project creation.</li>
</ul>
<p>The naming scheme of the (sub)partitions is as follows:</p>
<p><code>{table_name}_{MD5_org_hash}</code> for organization partitions</p>
<p><code>{table_name}_{MD5_project_hash}</code> for project partition</p>
<p>where</p>
<ul>
  <li><code>{table_name}</code> is either <code>scoped_events</code> or <code>scoped_states</code></li>
  <li><code>{MD5_org_hash}</code> is the MD5 hash of the organization name</li>
  <li><code>{MD5_project_hash}</code> is the MD5 hash of the project reference (i.e. has the form <code>{org_name}/{project_name}</code>)</li>
</ul>
<p>MD5 hashing is used in order to guarantee a constant partition name length (PostgreSQL table names are limited to 63 character by default), as well as to avoid any special characters that might be allowed in project names but not in PostgreSQL table names (such as <code>-</code>).</p>
<p>Example:</p>
<p>You create the organization called <code>myorg</code>, inside of which you create the <code>myproject</code> project. When the project is created, Nexus Delta will have created the following partitions:</p>
<ul>
  <li><code>scoped_events_B665280652D01C4679777AFD9861170C</code>, the partition of events from the <code>myorg</code> organization</li>
  <li><code>scoped_events_7922DA7049D5E38C83053EE145B27596</code>, the subpartition of the events from the <code>myorg/myproject</code> project</li>
  <li><code>scoped_states_B665280652D01C4679777AFD9861170C</code>, the partition of states from the <code>myorg</code> organization</li>
  <li><code>scoped_states_7922DA7049D5E38C83053EE145B27596</code>, the subpartition of the states from the <code>myorg/myproject</code> project</li>
</ul>
<h4><a href="#hash-partitioning" name="hash-partitioning" class="anchor"><span class="anchor-link"></span></a>Hash partitioning</h4>
<p>Since 1.12, Nexus allows hash partitioning. This strategy is best when you have a lot of projects containing a small amount of resources.</p>
<p>The <code>public.scoped_events</code> and <code>public.scoped_states</code> are partitioned with a fixed number of partitions where all events and states from a given project will end up in the same partition.</p>
<p>Nexus takes care of creating the different partitions the first time it starts with this configuration.</p>
<p>The naming scheme of the partitions is as follows:</p>
<ul>
  <li><code>{table_name}_{(%04d)}</code> (ex: <code>scoped_events_0001</code>)</li>
</ul>
<h4><a href="#advanced-subpartitioning" name="advanced-subpartitioning" class="anchor"><span class="anchor-link"></span></a>Advanced subpartitioning</h4>
<p>While Nexus Delta provides table partitioning out-of-the-box, it is primarily addressing the case where the data is more or less uniformly spread out across multiple projects. If however there is one or more project that are very large, it is possible to add further subpartitions according to a custom rule. This custom subpartitioning must be decided on a case-by-case basis using your knowledge of the given project; the idea is to create uniform partitions of your project.</p>
<p>Please refer to the <a href="https://www.postgresql.org/docs/current/ddl-partitioning.html" title="PostgreSQL Table Partitioning documentation">PostgreSQL Table Partitioning documentation</a>.</p>
<h2><a href="#tables" name="tables" class="anchor"><span class="anchor-link"></span></a>Tables</h2>
<h3><a href="#initializing-the-schema" name="initializing-the-schema" class="anchor"><span class="anchor-link"></span></a>Initializing the schema</h3>
<p>The different scripts are available <a href="https://github.com/BlueBrain/nexus/tree/master/delta/sourcing-psql/src/main/resources/scripts/postgres/init" title="here">here</a> They must be run in the alphabetical order.</p>
<h3><a href="#description" name="description" class="anchor"><span class="anchor-link"></span></a>Description</h3>
<p><strong>global_events/global_states:</strong> Stores the events and the current states for entities which do not belong to a project (ex: realm, acl).</p>
<p>The events and states are structured as logs and can be ordered via the <code>ordering</code> column.</p>
<p><strong>scoped_events/scoped_states:</strong> Stores the events and the tagged and current states for entities which belong to a project (ex: resource, file and project itself).</p>
<p>The events and states are structured as logs and can be ordered via the <code>ordering</code> column.</p>
<p>The indexing routines rely heavily on the <code>scoped_states</code> table,</p>
<p>Those tables are partitioned as described in the <a href="postgresql.html#postgresql-partitioning">following section</a>.</p>
<p><strong>scoped_tombstones:</strong> This table allows to notify the indexing routines that a resource state has lost a property like a type or a tags so that they can on their end delete the indexed resource from Elasticsearch for example.</p>
<p>The rows in this table are short-lived and are only as their notify purpose is temporary.</p>
<p><strong>ephemeral_states:</strong> Stores the states for entities which are immutable and short-lived (ex: archives).</p>
<p><strong>entity_dependencies:</strong> Stores the relationship of some entities in a project with entities living in other project preventing to delete projects when other resources from other project still point to it (ex: cross-project resolver, aggregate views).</p>
<p><strong>projection_offsets:</strong> Stores the progress and statistics of the indexing processes related to the different views (except for composite views) and some of the internal projections.</p>
<p><strong>composite_offsets:</strong> Stores the progress and statistics of the indexing processes related to composite views.</p>
<p><strong>projection_restarts:</strong> Allows to notify projections related to indexing views (except composite views) must be restarted.</p>
<p>The rows in this table are short-lived and are only as their notify purpose is temporary.</p>
<p><strong>composite_restarts:</strong> Same but for the composite views.</p>
<p>They are stored separately as more restart options are available for those views,</p>
<p><strong>failed_elem_logs:</strong> Stores errors which occured during the processing of some elements by projections (ex: a resource has been rejected by Elasticsearch as it does not respect the mapping).</p>
<p>The rows in this table are short-lived and are only as their purpose is temporary.</p>
<p><strong>deleted_project_reports:</strong> Stores the result of project deletions as a report.</p>
<p><strong>blazegraph_queries:</strong> Stores slow queries submitted to Blazegraph.</p>
<p>The rows in this table are short-lived as they only have a monitoring purpose.</p>
<p><strong>scope_initialization_errors:</strong> Stores error related to project initialization where Nexus Delta executes a list of actions such as creating a default Elasticsearch view.</p>
<p>Some of those actions may fail as it relies on external components (like a Blazegraph instance) which may be down at this moment.</p>
<p>This table allows to save the failures in order to be able to a posteriori call <a href="../delta/api/supervision-api.html#project-healing">the supervision healing endpoint</a>.</p>
<p><strong>project_last_updates:</strong> Stores the last_update and last_ordering properties for the different projects.</p>
<p>This table allows to power the passivation strategy for the different views.</p>
<h2><a href="#running-and-monitoring" name="running-and-monitoring" class="anchor"><span class="anchor-link"></span></a>Running and monitoring</h2>
<p><strong>CPU:</strong> High CPU usage suggests inefficient query execution and query plans, resource contention, deadlocks.</p>
<p><strong>Memory:</strong> Low memory indicates swapping and degraded performance.</p>
<p><strong>Storage:</strong> There should be enough available space for PostgreSQL to operate properly.</p>
<p>As described in the <a href="../delta/architecture.html">architecture section</a> the generally adopted persistence model is an EventSourced model in which the data store is used as an <em>append only</em> store. This has implications to the total amount of disk used by the primary store.</p>
<p><strong>Locks:</strong> Locks can lead to high cpu usage and instability and are to be monitored and fixed.</p>
<p><strong>Read and write query throughput and performance:</strong> Helps to identify slow queries and potential issues with reading and writing data</p>
<p><strong>Active sessions:</strong> To avoid resource contention and to plan for scalability.</p>
<p><strong>Replication status and lag:</strong> To identify high availability and data consistency issues across replicated instances High CPU and memory usage in one or several nodes can lead to increased replication lags</p>
<h2><a href="#tools-and-resources" name="tools-and-resources" class="anchor"><span class="anchor-link"></span></a>Tools and resources</h2>
<p>An approach to monitor PostgreSQL with Prometheus is to use Postgres exporter from the <a href="https://github.com/prometheus-community/postgres_exporter" title="Prometheus community">Prometheus community</a>.</p>
<p>The PostgreSQL website also has a whole section about <a href="https://www.postgresql.org/docs/current/monitoring.html" title="monitoring">monitoring</a> and the <a href="https://www.postgresql.org/docs/current/pgstatstatements.html" title="pg_statstatements">pg_statstatements</a> allows to get statistics about the queries executed by the server.</p>
</div>
<div>
<a href="https://github.com/BlueBrain/nexus/tree/master/docs/src/main/paradox/docs/running-nexus/postgresql.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
Snapshot
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../docs/running-nexus/index.html" title="Running Nexus" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Running Nexus
</span>
</div>
</a>
<a href="../../docs/running-nexus/elasticsearch.html" title="Elasticsearch" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Elasticsearch
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Nexus is Open Source and available under the Apache 2 License.<br/>
© 2017-2025 <a href="https://epfl.ch/">EPFL</a>
 <a href="https://bluebrain.epfl.ch/">The Blue Brain Project</a>

</div>
</div>
<div class="md-footer-social">
<a href="https://github.com/BlueBrain" class="md-footer-social__link fa fa-github"></a><a href="https://github.com/BlueBrain/nexus/discussions" class="md-footer-social__link fa fa-github"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../.././public/js/gtm.js"></script>
</body>
</html>
