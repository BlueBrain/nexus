{"version":3,"sources":["../../src/utils/webpack.config.js"],"names":["require","crypto","fs","path","dotenv","PnpWebpackPlugin","CoreJSResolver","store","actions","getPublicPath","debug","report","apiRunnerNode","FRAMEWORK_BUNDLES","module","exports","program","directory","suppliedStage","port","parentSpan","modulesThatUseGatsby","directoryPath","process","env","GATSBY_BUILD_STAGE","stage","rules","loaders","plugins","assetPrefix","pathPrefix","getState","config","publicPath","processEnv","defaultNodeEnv","nodeEnv","NODE_ENV","configEnv","GATSBY_ACTIVE_ENV","envFile","join","cwd","parsed","parse","readFileSync","encoding","err","code","error","envObject","Object","keys","reduce","acc","key","JSON","stringify","gatsbyVarObject","match","PUBLIC_DIR","BUILD_STAGE","CYPRESS_SUPPORT","mergedEnvVars","assign","getHmrPath","hmrBasePath","hmrSuffix","GATSBY_WEBPACK_PUBLICPATH","pubPath","substr","getOutput","filename","pathinfo","devtoolModuleFilenameTemplate","info","resolve","absoluteResourcePath","replace","crossOriginLoading","libraryTarget","library","umdNamedDefine","globalObject","chunkFilename","Error","getEntry","polyfill","commons","main","app","getPlugins","configPlugins","moment","define","__BASE_PATH__","prefixPaths","__PATH_PREFIX__","__ASSET_PREFIX__","virtualModules","concat","GATSBY_HOT_LOADER","fastRefresh","hotModuleReplacement","noEmitOnErrors","eslintGraphqlSchemaReload","filter","Boolean","extractText","extractStats","getDevtool","getMode","getModule","configRules","js","yaml","fonts","images","media","miscAssets","test","type","use","loader","push","dependencies","themes","map","theme","include","themeDir","schema","eslint","oneOf","cssModules","css","null","getResolve","extensions","alias","gatsby$","dirname","$virtual","bind","target","noOp","objectAssignStub","fetchStub","whatwgFetchStub","unfetch$","profile","getResolveLoader","root","userLoaderDirectoryPath","statSync","isDirectory","modules","__dirname","moduleLoader","context","entry","output","devtool","performance","hints","mode","resolveLoader","node","__filename","componentsCount","components","size","isCssModule","splitChunks","chunks","cacheGroups","default","vendors","framework","name","RegExp","priority","enforce","lib","identifier","hash","createHash","libIdent","update","digest","substring","minChunks","reuseExistingChunk","Math","max","shared","chunk","styles","maxAsyncRequests","Infinity","maxInitialRequests","minSize","optimization","runtimeChunk","moduleIds","minimizer","noUglify","minifyJs","terserOptions","keep_classnames","keep_fnames","minifyCss","externalList","userExternalList","checkItem","item","request","isExternal","some","externals","callback","external","dispatch","replaceWebpackConfig","getConfig","webpack"],"mappings":"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","sourcesContent":["require(`v8-compile-cache`)\n\nconst crypto = require(`crypto`)\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst dotenv = require(`dotenv`)\nconst PnpWebpackPlugin = require(`pnp-webpack-plugin`)\nconst { CoreJSResolver } = require(`./webpack/corejs-resolver`)\nconst { store } = require(`../redux`)\nconst { actions } = require(`../redux/actions`)\nconst { getPublicPath } = require(`./get-public-path`)\nconst debug = require(`debug`)(`gatsby:webpack-config`)\nconst report = require(`gatsby-cli/lib/reporter`)\nimport { withBasePath, withTrailingSlash } from \"./path\"\nimport { getGatsbyDependents } from \"./gatsby-dependents\"\nconst apiRunnerNode = require(`./api-runner-node`)\nimport { createWebpackUtils } from \"./webpack-utils\"\nimport { hasLocalEslint } from \"./local-eslint-config-finder\"\nimport { getAbsolutePathForVirtualModule } from \"./gatsby-webpack-virtual-modules\"\n\nconst FRAMEWORK_BUNDLES = [`react`, `react-dom`, `scheduler`, `prop-types`]\n\n// Four stages or modes:\n//   1) develop: for `gatsby develop` command, hot reload and CSS injection into page\n//   2) develop-html: same as develop without react-hmre in the babel config for html renderer\n//   3) build-javascript: Build JS and CSS chunks for production\n//   4) build-html: build all HTML files\n\nmodule.exports = async (\n  program,\n  directory,\n  suppliedStage,\n  port,\n  { parentSpan } = {}\n) => {\n  const modulesThatUseGatsby = await getGatsbyDependents()\n  const directoryPath = withBasePath(directory)\n\n  process.env.GATSBY_BUILD_STAGE = suppliedStage\n\n  // We combine develop & develop-html stages for purposes of generating the\n  // webpack config.\n  const stage = suppliedStage\n  const { rules, loaders, plugins } = createWebpackUtils(stage, program)\n\n  const { assetPrefix, pathPrefix } = store.getState().config\n\n  const publicPath = getPublicPath({ assetPrefix, pathPrefix, ...program })\n\n  function processEnv(stage, defaultNodeEnv) {\n    debug(`Building env for \"${stage}\"`)\n    // node env should be DEVELOPMENT | PRODUCTION as these are commonly used in node land\n    // this variable is used inside webpack\n    const nodeEnv = process.env.NODE_ENV || `${defaultNodeEnv}`\n    // config env is dependent on the env that it's run, this can be anything from staging-production\n    // this allows you to set use different .env environments or conditions in gatsby files\n    const configEnv = process.env.GATSBY_ACTIVE_ENV || nodeEnv\n    const envFile = path.join(process.cwd(), `./.env.${configEnv}`)\n    let parsed = {}\n    try {\n      parsed = dotenv.parse(fs.readFileSync(envFile, { encoding: `utf8` }))\n    } catch (err) {\n      if (err.code !== `ENOENT`) {\n        report.error(\n          `There was a problem processing the .env file (${envFile})`,\n          err\n        )\n      }\n    }\n\n    const envObject = Object.keys(parsed).reduce((acc, key) => {\n      acc[key] = JSON.stringify(parsed[key])\n      return acc\n    }, {})\n\n    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {\n      if (key.match(/^GATSBY_/)) {\n        acc[key] = JSON.stringify(process.env[key])\n      }\n      return acc\n    }, {})\n\n    // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things\n    envObject.NODE_ENV = JSON.stringify(nodeEnv)\n    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`)\n    envObject.BUILD_STAGE = JSON.stringify(stage)\n    envObject.CYPRESS_SUPPORT = JSON.stringify(process.env.CYPRESS_SUPPORT)\n\n    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject)\n\n    return Object.keys(mergedEnvVars).reduce(\n      (acc, key) => {\n        acc[`process.env.${key}`] = mergedEnvVars[key]\n        return acc\n      },\n      {\n        \"process.env\": `({})`,\n      }\n    )\n  }\n\n  function getHmrPath() {\n    // ref: https://github.com/gatsbyjs/gatsby/issues/8348\n    let hmrBasePath = `/`\n    const hmrSuffix = `__webpack_hmr&reload=true&overlay=false`\n\n    if (process.env.GATSBY_WEBPACK_PUBLICPATH) {\n      const pubPath = process.env.GATSBY_WEBPACK_PUBLICPATH\n      if (pubPath.substr(-1) === `/`) {\n        hmrBasePath = pubPath\n      } else {\n        hmrBasePath = withTrailingSlash(pubPath)\n      }\n    }\n\n    return hmrBasePath + hmrSuffix\n  }\n\n  debug(`Loading webpack config for stage \"${stage}\"`)\n  function getOutput() {\n    switch (stage) {\n      case `develop`:\n        return {\n          path: directory,\n          filename: `[name].js`,\n          // Add /* filename */ comments to generated require()s in the output.\n          pathinfo: true,\n          // Point sourcemap entries to original disk location (format as URL on Windows)\n          publicPath: process.env.GATSBY_WEBPACK_PUBLICPATH || `/`,\n          devtoolModuleFilenameTemplate: info =>\n            path.resolve(info.absoluteResourcePath).replace(/\\\\/g, `/`),\n          // Avoid React cross-origin errors\n          // See https://reactjs.org/docs/cross-origin-errors.html\n          crossOriginLoading: `anonymous`,\n        }\n      case `build-html`:\n      case `develop-html`:\n        // A temp file required by static-site-generator-plugin. See plugins() below.\n        // Deleted by build-html.js, since it's not needed for production.\n        return {\n          path: directoryPath(`public`),\n          filename: `render-page.js`,\n          libraryTarget: `umd`,\n          library: `lib`,\n          umdNamedDefine: true,\n          globalObject: `this`,\n          publicPath: withTrailingSlash(publicPath),\n        }\n      case `build-javascript`:\n        return {\n          filename: `[name]-[contenthash].js`,\n          chunkFilename: `[name]-[contenthash].js`,\n          path: directoryPath(`public`),\n          publicPath: withTrailingSlash(publicPath),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getEntry() {\n    switch (stage) {\n      case `develop`:\n        return {\n          polyfill: directoryPath(`.cache/polyfill-entry`),\n          commons: [\n            `${require.resolve(\n              `webpack-hot-middleware/client`\n            )}?path=${getHmrPath()}`,\n            directoryPath(`.cache/app`),\n          ],\n        }\n      case `develop-html`:\n        return {\n          main: directoryPath(`.cache/develop-static-entry`),\n        }\n      case `build-html`:\n        return {\n          main: directoryPath(`.cache/static-entry`),\n        }\n      case `build-javascript`:\n        return {\n          polyfill: directoryPath(`.cache/polyfill-entry`),\n          app: directoryPath(`.cache/production-app`),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getPlugins() {\n    let configPlugins = [\n      plugins.moment(),\n\n      // Add a few global variables. Set NODE_ENV to production (enables\n      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).\n      plugins.define({\n        ...processEnv(stage, `development`),\n        __BASE_PATH__: JSON.stringify(program.prefixPaths ? pathPrefix : ``),\n        __PATH_PREFIX__: JSON.stringify(program.prefixPaths ? publicPath : ``),\n        __ASSET_PREFIX__: JSON.stringify(\n          program.prefixPaths ? assetPrefix : ``\n        ),\n      }),\n\n      plugins.virtualModules(),\n    ]\n\n    switch (stage) {\n      case `develop`:\n        configPlugins = configPlugins\n          .concat([\n            process.env.GATSBY_HOT_LOADER === `fast-refresh` &&\n              plugins.fastRefresh(),\n            plugins.hotModuleReplacement(),\n            plugins.noEmitOnErrors(),\n            plugins.eslintGraphqlSchemaReload(),\n          ])\n          .filter(Boolean)\n        break\n      case `build-javascript`: {\n        configPlugins = configPlugins.concat([\n          plugins.extractText(),\n          // Write out stats object mapping named dynamic imports (aka page\n          // components) to all their async chunks.\n          plugins.extractStats(),\n        ])\n        break\n      }\n    }\n\n    return configPlugins\n  }\n\n  function getDevtool() {\n    switch (stage) {\n      case `develop`:\n        return `cheap-module-source-map`\n      // use a normal `source-map` for the html phases since\n      // it gives better line and column numbers\n      case `develop-html`:\n      case `build-html`:\n      case `build-javascript`:\n        return `source-map`\n      default:\n        return false\n    }\n  }\n\n  function getMode() {\n    switch (stage) {\n      case `build-javascript`:\n        return `production`\n      case `develop`:\n      case `develop-html`:\n      case `build-html`:\n        return `development` // So we don't uglify the html bundle\n      default:\n        return `production`\n    }\n  }\n\n  function getModule() {\n    // Common config for every env.\n    // prettier-ignore\n    let configRules = [\n      rules.js({\n        modulesThatUseGatsby,\n      }),\n      rules.yaml(),\n      rules.fonts(),\n      rules.images(),\n      rules.media(),\n      rules.miscAssets(),\n\n      // This is a hack that exports one of @reach/router internals (BaseContext)\n      // to export list. We need it to reset basepath and baseuri context after\n      // Gatsby main router changes it, to keep v2 behaviour.\n      // We will need to most likely remove this for v3.\n      {\n        test: require.resolve(`@reach/router/es/index`),\n        type: `javascript/auto`,\n        use: [{\n          loader: require.resolve(`./reach-router-add-basecontext-export-loader`),\n        }],\n      }\n    ]\n\n    // Speedup 🏎️💨 the build! We only include transpilation of node_modules on javascript production builds\n    // TODO create gatsby plugin to enable this behaviour on develop (only when people are requesting this feature)\n    if (stage === `build-javascript`) {\n      configRules.push(\n        rules.dependencies({\n          modulesThatUseGatsby,\n        })\n      )\n    }\n\n    if (store.getState().themes.themes) {\n      configRules = configRules.concat(\n        store.getState().themes.themes.map(theme => {\n          return {\n            test: /\\.jsx?$/,\n            include: theme.themeDir,\n            use: [loaders.js()],\n          }\n        })\n      )\n    }\n\n    switch (stage) {\n      case `develop`: {\n        // get schema to pass to eslint config and program for directory\n        const { schema, program } = store.getState()\n\n        // if no local eslint config, then add gatsby config\n        if (!hasLocalEslint(program.directory)) {\n          configRules = configRules.concat([rules.eslint(schema)])\n        }\n\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        // RHL will patch React, replace React-DOM by React-🔥-DOM and work with fiber directly\n        // It's necessary to remove the warning in console (https://github.com/gatsbyjs/gatsby/issues/11934)\n        // TODO: Remove entire block when we make fast-refresh the default\n        if (process.env.GATSBY_HOT_LOADER !== `fast-refresh`) {\n          configRules.push({\n            include: /node_modules\\/react-dom/,\n            test: /\\.jsx?$/,\n            use: {\n              loader: require.resolve(`./webpack-hmr-hooks-patch`),\n            },\n          })\n        }\n\n        break\n      }\n      case `build-html`:\n      case `develop-html`:\n        // We don't deal with CSS at all when building the HTML.\n        // The 'null' loader is used to prevent 'module not found' errors.\n        // On the other hand CSS modules loaders are necessary.\n\n        // prettier-ignore\n        configRules = configRules.concat([\n          {\n            oneOf: [\n              rules.cssModules(),\n              {\n                ...rules.css(),\n                use: [loaders.null()],\n              },\n            ],\n          },\n        ])\n        break\n\n      case `build-javascript`:\n        // We don't deal with CSS at all when building JavaScript but we still\n        // need to process the CSS so offline-plugin knows about the various\n        // assets referenced in your CSS.\n        //\n        // It's also necessary to process CSS Modules so your JS knows the\n        // classNames to use.\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n    }\n\n    return { rules: configRules }\n  }\n\n  function getResolve(stage) {\n    const { program } = store.getState()\n    const resolve = {\n      // Use the program's extension list (generated via the\n      // 'resolvableExtensions' API hook).\n      extensions: [...program.extensions],\n      alias: {\n        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),\n        // Using directories for module resolution is mandatory because\n        // relative path imports are used sometimes\n        // See https://stackoverflow.com/a/49455609/6420957 for more details\n        \"@babel/runtime\": path.dirname(\n          require.resolve(`@babel/runtime/package.json`)\n        ),\n        // TODO: Remove entire block when we make fast-refresh the default\n        ...(process.env.GATSBY_HOT_LOADER !== `fast-refresh`\n          ? {\n              \"react-hot-loader\": path.dirname(\n                require.resolve(`react-hot-loader/package.json`)\n              ),\n            }\n          : {}),\n        \"react-lifecycles-compat\": directoryPath(\n          `.cache/react-lifecycles-compat.js`\n        ),\n        \"create-react-context\": directoryPath(`.cache/create-react-context.js`),\n        \"@pmmmwh/react-refresh-webpack-plugin\": path.dirname(\n          require.resolve(`@pmmmwh/react-refresh-webpack-plugin/package.json`)\n        ),\n        \"socket.io-client\": path.dirname(\n          require.resolve(`socket.io-client/package.json`)\n        ),\n        $virtual: getAbsolutePathForVirtualModule(`$virtual`),\n      },\n      plugins: [\n        // Those two folders are special and contain gatsby-generated files\n        // whose dependencies should be resolved through the `gatsby` package\n        PnpWebpackPlugin.bind(directoryPath(`.cache`), module),\n        PnpWebpackPlugin.bind(directoryPath(`public`), module),\n        // Transparently resolve packages via PnP when needed; noop otherwise\n        PnpWebpackPlugin,\n        new CoreJSResolver(),\n      ],\n    }\n\n    const target =\n      stage === `build-html` || stage === `develop-html` ? `node` : `web`\n    if (target === `web`) {\n      const noOp = directoryPath(`.cache/polyfills/no-op.js`)\n      const objectAssignStub = directoryPath(\n        `.cache/polyfills/object-assign.js`\n      )\n      const fetchStub = directoryPath(`.cache/polyfills/fetch.js`)\n      const whatwgFetchStub = directoryPath(`.cache/polyfills/whatwg-fetch.js`)\n      resolve.alias = Object.assign(\n        {},\n        {\n          // force to use es modules when importing internals of @reach.router\n          // for browser bundles\n          \"@reach/router\": path.join(\n            path.dirname(require.resolve(`@reach/router/package.json`)),\n            `es`\n          ),\n\n          // These files are already polyfilled so these should return in a no-op\n          // Stub Package: object.assign & object-assign\n          \"object.assign\": objectAssignStub,\n          \"object-assign$\": objectAssignStub,\n          \"@babel/runtime/helpers/extends.js$\": objectAssignStub,\n          // Stub package: fetch\n          unfetch$: fetchStub,\n          \"unfetch/polyfill$\": noOp,\n          \"isomorphic-unfetch$\": fetchStub,\n          \"whatwg-fetch$\": whatwgFetchStub,\n          // Stub package: url-polyfill\n          \"url-polyfill$\": noOp,\n        },\n        resolve.alias\n      )\n    }\n\n    if (stage === `build-javascript` && program.profile) {\n      resolve.alias[`react-dom$`] = `react-dom/profiling`\n      resolve.alias[`scheduler/tracing`] = `scheduler/tracing-profiling`\n    }\n    return resolve\n  }\n\n  function getResolveLoader() {\n    const root = [path.resolve(directory, `node_modules`)]\n\n    const userLoaderDirectoryPath = path.resolve(directory, `loaders`)\n\n    try {\n      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {\n        root.push(userLoaderDirectoryPath)\n      }\n    } catch (err) {\n      debug(`Error resolving user loaders directory`, err)\n    }\n\n    return {\n      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`],\n      // Bare loaders should always be loaded via the user dependencies (loaders\n      // configured via third-party like gatsby use require.resolve)\n      plugins: [PnpWebpackPlugin.moduleLoader(`${directory}/`)],\n    }\n  }\n\n  const config = {\n    // Context is the base directory for resolving the entry option.\n    context: directory,\n    entry: getEntry(),\n    output: getOutput(),\n\n    module: getModule(),\n    plugins: getPlugins(),\n\n    // Certain \"isomorphic\" packages have different entry points for browser\n    // and server (see\n    // https://github.com/defunctzombie/package-browser-field-spec); setting\n    // the target tells webpack which file to include, ie. browser vs main.\n    target: stage === `build-html` || stage === `develop-html` ? `node` : `web`,\n\n    devtool: getDevtool(),\n    // Turn off performance hints as we (for now) don't want to show the normal\n    // webpack output anywhere.\n    performance: {\n      hints: false,\n    },\n    mode: getMode(),\n\n    resolveLoader: getResolveLoader(),\n    resolve: getResolve(stage),\n\n    node: {\n      __filename: true,\n    },\n  }\n\n  if (stage === `build-javascript`) {\n    const componentsCount = store.getState().components.size\n    const isCssModule = module => module.type === `css/mini-extract`\n\n    const splitChunks = {\n      chunks: `all`,\n      cacheGroups: {\n        default: false,\n        vendors: false,\n        framework: {\n          chunks: `all`,\n          name: `framework`,\n          // This regex ignores nested copies of framework libraries so they're bundled with their issuer.\n          test: new RegExp(\n            `(?<!node_modules.*)[\\\\\\\\/]node_modules[\\\\\\\\/](${FRAMEWORK_BUNDLES.join(\n              `|`\n            )})[\\\\\\\\/]`\n          ),\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from becoming a part of the commons chunk)\n          enforce: true,\n        },\n        // if a module is bigger than 160kb from node_modules we make a separate chunk for it\n        lib: {\n          test(module) {\n            return (\n              !isCssModule(module) &&\n              module.size() > 160000 &&\n              /node_modules[/\\\\]/.test(module.identifier())\n            )\n          },\n          name(module) {\n            const hash = crypto.createHash(`sha1`)\n            if (!module.libIdent) {\n              throw new Error(\n                `Encountered unknown module type: ${module.type}. Please open an issue.`\n              )\n            }\n\n            hash.update(module.libIdent({ context: program.directory }))\n\n            return hash.digest(`hex`).substring(0, 8)\n          },\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true,\n        },\n        commons: {\n          name: `commons`,\n          // if a chunk is used on all components we put it in commons (we need at least 2 components)\n          minChunks: Math.max(componentsCount, 2),\n          priority: 20,\n        },\n        // If a chunk is used in at least 2 components we create a separate chunk\n        shared: {\n          test(module) {\n            return !isCssModule(module)\n          },\n          name(module, chunks) {\n            const hash = crypto\n              .createHash(`sha1`)\n              .update(chunks.reduce((acc, chunk) => acc + chunk.name, ``))\n              .digest(`hex`)\n\n            return hash\n          },\n          priority: 10,\n          minChunks: 2,\n          reuseExistingChunk: true,\n        },\n\n        // Bundle all css & lazy css into one stylesheet to make sure lazy components do not break\n        // TODO make an exception for css-modules\n        styles: {\n          test(module) {\n            return isCssModule(module)\n          },\n\n          name: `styles`,\n          priority: 40,\n          enforce: true,\n        },\n      },\n      // We load our pages async through async-requires, maxInitialRequests doesn't have an effect on chunks derived from page components.\n      // By default webpack has set maxAsyncRequests to 6, in some cases this isn't enough an actually makes the bundle size blow up.\n      // We've set maxAsyncRequests to Infinity to negate this. This could potentionally exceed the 25 initial requests that we set before\n      // sadly I do not have a better solution.\n      maxAsyncRequests: Infinity,\n      maxInitialRequests: 25,\n      minSize: 20000,\n    }\n\n    config.optimization = {\n      runtimeChunk: {\n        name: `webpack-runtime`,\n      },\n      // use hashes instead of ids for module identifiers\n      // TODO update to deterministic in webpack 5 (hashed is deprecated)\n      // @see https://webpack.js.org/guides/caching/#module-identifiers\n      moduleIds: `hashed`,\n      splitChunks,\n      minimizer: [\n        // TODO: maybe this option should be noMinimize?\n        !program.noUglify &&\n          plugins.minifyJs(\n            program.profile\n              ? {\n                  terserOptions: {\n                    keep_classnames: true,\n                    keep_fnames: true,\n                  },\n                }\n              : {}\n          ),\n        plugins.minifyCss(),\n      ].filter(Boolean),\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    // Packages we want to externalize to save some build time\n    // https://github.com/gatsbyjs/gatsby/pull/14208#pullrequestreview-240178728\n    const externalList = [\n      `@reach/router/lib/history`,\n      `@reach/router`,\n      `common-tags`,\n      `crypto`,\n      `debug`,\n      `fs`,\n      `https`,\n      `http`,\n      `lodash`,\n      `path`,\n      `semver`,\n      /^lodash\\//,\n      `zlib`,\n    ]\n\n    // Packages we want to externalize because meant to be user-provided\n    const userExternalList = [`react-helmet`, `react`, /^react-dom\\//]\n\n    const checkItem = (item, request) => {\n      if (typeof item === `string` && item === request) {\n        return true\n      } else if (item instanceof RegExp && item.test(request)) {\n        return true\n      }\n      return false\n    }\n\n    const isExternal = request => {\n      if (externalList.some(item => checkItem(item, request))) {\n        return `umd ${require.resolve(request)}`\n      }\n      if (userExternalList.some(item => checkItem(item, request))) {\n        return `umd ${request}`\n      }\n      return null\n    }\n\n    config.externals = [\n      function (context, request, callback) {\n        const external = isExternal(request)\n        if (external !== null) {\n          callback(null, external)\n        } else {\n          callback()\n        }\n      },\n    ]\n  }\n\n  store.dispatch(actions.replaceWebpackConfig(config))\n  const getConfig = () => store.getState().webpack\n\n  await apiRunnerNode(`onCreateWebpackConfig`, {\n    getConfig,\n    stage,\n    rules,\n    loaders,\n    plugins,\n    parentSpan,\n  })\n\n  return getConfig()\n}\n"],"file":"webpack.config.js"}