{"version":3,"sources":["../../../src/utils/worker/render-html.ts"],"names":["renderHTML","htmlComponentRendererPath","paths","envVars","forEach","key","value","process","env","Promise","map","path","resolve","reject","htmlComponentRenderer","require","default","_throwAway","htmlString","fs","outputFile","cwd","e","context"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEO,MAAMA,UAAU,GAAG,CAAC;AACzBC,EAAAA,yBADyB;AAEzBC,EAAAA,KAFyB;AAGzBC,EAAAA;AAHyB,CAAD,KAQA;AACxB;AACA;AACAA,EAAAA,OAAO,CAACC,OAAR,CAAgB,CAAC,CAACC,GAAD,EAAMC,KAAN,CAAD,KAAmBC,OAAO,CAACC,GAAR,CAAYH,GAAZ,IAAmBC,KAAtD;AAEA,SAAOG,kBAAQC,GAAR,CACLR,KADK,EAELS,IAAI,IACF,IAAIF,iBAAJ,CAAY,CAACG,OAAD,EAAUC,MAAV,KAAqB;AAC/B,UAAMC,qBAAqB,GAAGC,OAAO,CAACd,yBAAD,CAArC;;AACA,QAAI;AACFa,MAAAA,qBAAqB,CAACE,OAAtB,CAA8BL,IAA9B,EAAoC,CAACM,UAAD,EAAaC,UAAb,KAA4B;AAC9DN,QAAAA,OAAO,CACLO,iBAAGC,UAAH,CACE,mCAAoB,gBAAKb,OAAO,CAACc,GAAR,EAAL,EAAqB,QAArB,CAApB,EAAmDV,IAAnD,CADF,EAEEO,UAFF,CADK,CAAP;AAMD,OAPD;AAQD,KATD,CASE,OAAOI,CAAP,EAAU;AACV;AACAA,MAAAA,CAAC,CAACC,OAAF,GAAY;AACVZ,QAAAA;AADU,OAAZ;AAGAE,MAAAA,MAAM,CAACS,CAAD,CAAN;AACD;AACF,GAlBD,CAHG,CAAP;AAuBD,CApCM","sourcesContent":["import fs from \"fs-extra\"\nimport Promise from \"bluebird\"\nimport { join } from \"path\"\nimport { getPageHtmlFilePath } from \"../../utils/page-html\"\n\nexport const renderHTML = ({\n  htmlComponentRendererPath,\n  paths,\n  envVars,\n}: {\n  htmlComponentRendererPath: string\n  paths: string\n  envVars: [string, string][]\n}): Promise<unknown[]> => {\n  // This is being executed in child process, so we need to set some vars\n  // for modules that aren't bundled by webpack.\n  envVars.forEach(([key, value]) => (process.env[key] = value))\n\n  return Promise.map(\n    paths,\n    path =>\n      new Promise((resolve, reject) => {\n        const htmlComponentRenderer = require(htmlComponentRendererPath)\n        try {\n          htmlComponentRenderer.default(path, (_throwAway, htmlString) => {\n            resolve(\n              fs.outputFile(\n                getPageHtmlFilePath(join(process.cwd(), `public`), path),\n                htmlString\n              )\n            )\n          })\n        } catch (e) {\n          // add some context to error so we can display more helpful message\n          e.context = {\n            path,\n          }\n          reject(e)\n        }\n      })\n  )\n}\n"],"file":"render-html.js"}