{"version":3,"sources":["../../src/utils/stack-trace-utils.ts"],"names":["fs","require","path","chalk","isNodeInternalModulePath","gatsbyLocation","dirname","resolve","reduxThunkLocation","reduxLocation","getNonGatsbyCallSite","stackTrace","get","find","callSite","getFileName","includes","getNonGatsbyCodeFrame","highlightCode","fileName","line","getLineNumber","column","getColumnNumber","code","readFileSync","encoding","codeFrame","start","getNonGatsbyCodeFrameFormatted","possibleCodeFrame","bold"],"mappings":";;;;;;;AAAA;;AACA;;AACA,MAAMA,EAAE,GAAGC,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAE,OAAF,CAArB;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAA+BH,OAAO,CAAE,mBAAF,CAA5C;;AAEA,MAAMI,cAAc,GAAGH,IAAI,CAACI,OAAL,CAAaL,OAAO,CAACM,OAAR,CAAiB,qBAAjB,CAAb,CAAvB;AACA,MAAMC,kBAAkB,GAAGN,IAAI,CAACI,OAAL,CACzBL,OAAO,CAACM,OAAR,CAAiB,0BAAjB,CADyB,CAA3B;AAGA,MAAME,aAAa,GAAGP,IAAI,CAACI,OAAL,CAAaL,OAAO,CAACM,OAAR,CAAiB,oBAAjB,CAAb,CAAtB;;AAEA,MAAMG,oBAAoB,GAAG,MAC3BC,oBACGC,GADH,GAEGC,IAFH,CAGIC,QAAQ,IACNA,QAAQ,IACRA,QAAQ,CAACC,WAAT,EADA,IAEA,CAACD,QAAQ,CAACC,WAAT,GAAuBC,QAAvB,CAAgCX,cAAhC,CAFD,IAGA,CAACS,QAAQ,CAACC,WAAT,GAAuBC,QAAvB,CAAgCP,aAAhC,CAHD,IAIA,CAACK,QAAQ,CAACC,WAAT,GAAuBC,QAAvB,CAAgCR,kBAAhC,CAJD,IAKA,CAACJ,wBAAwB,CAACU,QAAQ,CAACC,WAAT,EAAD,CAT/B,CADF;;AAoBO,MAAME,qBAAqB,GAAG,CAAC;AACpCC,EAAAA,aAAa,GAAG;AADoB,IAElC,EAFiC,KAEP;AAC5B,QAAMJ,QAAQ,GAAGJ,oBAAoB,EAArC;;AACA,MAAI,CAACI,QAAL,EAAe;AACb,WAAO,IAAP;AACD;;AAED,QAAMK,QAAQ,GAAGL,QAAQ,CAACC,WAAT,EAAjB;AACA,QAAMK,IAAI,GAAGN,QAAQ,CAACO,aAAT,EAAb;AACA,QAAMC,MAAM,GAAGR,QAAQ,CAACS,eAAT,EAAf;AAEA,QAAMC,IAAI,GAAGxB,EAAE,CAACyB,YAAH,CAAgBN,QAAhB,EAA0B;AAAEO,IAAAA,QAAQ,EAAG;AAAb,GAA1B,CAAb;AACA,SAAO;AACLP,IAAAA,QADK;AAELC,IAAAA,IAFK;AAGLE,IAAAA,MAHK;AAILK,IAAAA,SAAS,EAAE,iCACTH,IADS,EAET;AACEI,MAAAA,KAAK,EAAE;AACLR,QAAAA,IADK;AAELE,QAAAA;AAFK;AADT,KAFS,EAQT;AACEJ,MAAAA;AADF,KARS;AAJN,GAAP;AAiBD,CA9BM;;;;AAgCA,MAAMW,8BAA8B,GAAG,CAAC;AAAEX,EAAAA,aAAa,GAAG;AAAlB,IAA2B,EAA5B,KAEhC;AACZ,QAAMY,iBAAiB,GAAGb,qBAAqB,CAAC;AAC9CC,IAAAA;AAD8C,GAAD,CAA/C;;AAIA,MAAI,CAACY,iBAAL,EAAwB;AACtB,WAAO,IAAP;AACD;;AAED,QAAM;AAAEX,IAAAA,QAAF;AAAYC,IAAAA,IAAZ;AAAkBE,IAAAA,MAAlB;AAA0BK,IAAAA;AAA1B,MAAwCG,iBAA9C;AACA,SAAQ,QAAO3B,KAAK,CAAC4B,IAAN,CAAY,GAAEZ,QAAS,IAAGC,IAAK,IAAGE,MAAO,EAAzC,CAA4C,KAAIK,SAAU,EAAzE;AACD,CAbM","sourcesContent":["import stackTrace, { StackFrame } from \"stack-trace\"\nimport { codeFrameColumns } from \"@babel/code-frame\"\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst chalk = require(`chalk`)\nconst { isNodeInternalModulePath } = require(`gatsby-core-utils`)\n\nconst gatsbyLocation = path.dirname(require.resolve(`gatsby/package.json`))\nconst reduxThunkLocation = path.dirname(\n  require.resolve(`redux-thunk/package.json`)\n)\nconst reduxLocation = path.dirname(require.resolve(`redux/package.json`))\n\nconst getNonGatsbyCallSite = (): StackFrame | undefined =>\n  stackTrace\n    .get()\n    .find(\n      callSite =>\n        callSite &&\n        callSite.getFileName() &&\n        !callSite.getFileName().includes(gatsbyLocation) &&\n        !callSite.getFileName().includes(reduxLocation) &&\n        !callSite.getFileName().includes(reduxThunkLocation) &&\n        !isNodeInternalModulePath(callSite.getFileName())\n    )\n\ninterface ICodeFrame {\n  fileName: string\n  line: number\n  column: number\n  codeFrame: string\n}\n\nexport const getNonGatsbyCodeFrame = ({\n  highlightCode = true,\n} = {}): null | ICodeFrame => {\n  const callSite = getNonGatsbyCallSite()\n  if (!callSite) {\n    return null\n  }\n\n  const fileName = callSite.getFileName()\n  const line = callSite.getLineNumber()\n  const column = callSite.getColumnNumber()\n\n  const code = fs.readFileSync(fileName, { encoding: `utf-8` })\n  return {\n    fileName,\n    line,\n    column,\n    codeFrame: codeFrameColumns(\n      code,\n      {\n        start: {\n          line,\n          column,\n        },\n      },\n      {\n        highlightCode,\n      }\n    ),\n  }\n}\n\nexport const getNonGatsbyCodeFrameFormatted = ({ highlightCode = true } = {}):\n  | null\n  | string => {\n  const possibleCodeFrame = getNonGatsbyCodeFrame({\n    highlightCode,\n  })\n\n  if (!possibleCodeFrame) {\n    return null\n  }\n\n  const { fileName, line, column, codeFrame } = possibleCodeFrame\n  return `File ${chalk.bold(`${fileName}:${line}:${column}`)}\\n${codeFrame}`\n}\n"],"file":"stack-trace-utils.js"}