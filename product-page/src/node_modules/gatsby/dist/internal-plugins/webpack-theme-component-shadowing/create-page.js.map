{"version":3,"sources":["../../../src/internal-plugins/webpack-theme-component-shadowing/create-page.js"],"names":["path","require","GatsbyThemeComponentShadowingResolverPlugin","store","pathWithoutExtension","fullPath","parsed","parse","join","dir","name","module","exports","pageComponent","shadowingPlugin","extensions","getState","program","themes","flattenedPlugins","map","aPlugin","themeDir","pluginFilepath","themeName","projectRoot","directory","matchingThemes","getMatchingThemesForPath","length","Error","theme","pageComponentWithoutExtension","component","split","componentPath","resolveComponentPath","matchingTheme"],"mappings":";;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AAEA,MAAMC,2CAA2C,GAAGD,OAAO,CAAE,GAAF,CAA3D;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAYF,OAAO,CAAE,aAAF,CAAzB;;AAEA,MAAMG,oBAAoB,GAAGC,QAAQ,IAAI;AACvC,QAAMC,MAAM,GAAGN,IAAI,CAACO,KAAL,CAAWF,QAAX,CAAf;AACA,SAAOL,IAAI,CAACQ,IAAL,CAAUF,MAAM,CAACG,GAAjB,EAAsBH,MAAM,CAACI,IAA7B,CAAP;AACD,CAHD;;AAKAC,MAAM,CAACC,OAAP,GAAiB,UAAUC,aAAV,EAAyB;AACxC,QAAMC,eAAe,GAAG,IAAIZ,2CAAJ,CAAgD;AACtEa,IAAAA,UAAU,EAAEZ,KAAK,CAACa,QAAN,GAAiBC,OAAjB,CAAyBF,UADiC;AAEtEG,IAAAA,MAAM,EAAEf,KAAK,CAACa,QAAN,GAAiBG,gBAAjB,CAAkCC,GAAlC,CAAsCC,OAAO,IAAI;AACvD,aAAO;AACLC,QAAAA,QAAQ,EAAED,OAAO,CAACE,cADb;AAELC,QAAAA,SAAS,EAAEH,OAAO,CAACX;AAFd,OAAP;AAID,KALO,CAF8D;AAQtEe,IAAAA,WAAW,EAAEtB,KAAK,CAACa,QAAN,GAAiBC,OAAjB,CAAyBS;AARgC,GAAhD,CAAxB;AAUA,QAAMC,cAAc,GAAGb,eAAe,CAACc,wBAAhB,CAAyCf,aAAzC,CAAvB;;AACA,MAAIc,cAAc,CAACE,MAAf,GAAwB,CAA5B,EAA+B;AAC7B,UAAM,IAAIC,KAAJ,CACH,6CAA4CH,cAAc,CACxDP,GAD0C,CACtCW,KAAK,IAAIA,KAAK,CAACP,SADuB,EAE1ChB,IAF0C,CAEpC,OAFoC,CAE5B,aAAYK,aAAc,EAHvC,CAAN;AAKD;;AAED,MAAIc,cAAc,CAACE,MAAf,IAAyB,CAA7B,EAAgC;AAC9B,UAAM,CAACE,KAAD,IAAUJ,cAAhB;AAEA,UAAMK,6BAA6B,GAAG5B,oBAAoB,CAACS,aAAD,CAA1D;AACA,UAAM,GAAGoB,SAAH,IAAgBD,6BAA6B,CAACE,KAA9B,CACpBlC,IAAI,CAACQ,IAAL,CAAUuB,KAAK,CAACT,QAAhB,EAA2B,KAA3B,CADoB,CAAtB;AAGA,UAAMa,aAAa,GAAGrB,eAAe,CAACsB,oBAAhB,CAAqC;AACzDC,MAAAA,aAAa,EAAEN,KAAK,CAACP,SADoC;AAEzDN,MAAAA,MAAM,EAAEJ,eAAe,CAACI,MAFiC;AAGzDe,MAAAA;AAHyD,KAArC,CAAtB;;AAKA,QAAIE,aAAJ,EAAmB;AACjB,aAAOA,aAAP;AACD;AACF;;AACD,SAAO,KAAP;AACD,CArCD","sourcesContent":["const path = require(`path`)\n\nconst GatsbyThemeComponentShadowingResolverPlugin = require(`.`)\nconst { store } = require(`../../redux`)\n\nconst pathWithoutExtension = fullPath => {\n  const parsed = path.parse(fullPath)\n  return path.join(parsed.dir, parsed.name)\n}\n\nmodule.exports = function (pageComponent) {\n  const shadowingPlugin = new GatsbyThemeComponentShadowingResolverPlugin({\n    extensions: store.getState().program.extensions,\n    themes: store.getState().flattenedPlugins.map(aPlugin => {\n      return {\n        themeDir: aPlugin.pluginFilepath,\n        themeName: aPlugin.name,\n      }\n    }),\n    projectRoot: store.getState().program.directory,\n  })\n  const matchingThemes = shadowingPlugin.getMatchingThemesForPath(pageComponent)\n  if (matchingThemes.length > 1) {\n    throw new Error(\n      `Gatsby can't differentiate between themes ${matchingThemes\n        .map(theme => theme.themeName)\n        .join(` and `)} for path ${pageComponent}`\n    )\n  }\n\n  if (matchingThemes.length == 1) {\n    const [theme] = matchingThemes\n\n    const pageComponentWithoutExtension = pathWithoutExtension(pageComponent)\n    const [, component] = pageComponentWithoutExtension.split(\n      path.join(theme.themeDir, `src`)\n    )\n    const componentPath = shadowingPlugin.resolveComponentPath({\n      matchingTheme: theme.themeName,\n      themes: shadowingPlugin.themes,\n      component,\n    })\n    if (componentPath) {\n      return componentPath\n    }\n  }\n  return false\n}\n"],"file":"create-page.js"}