{"version":3,"file":"StickyObserver.esm.js","sources":["../../../../src/components/StickyObserver/StickyObserver.tsx"],"sourcesContent":["/** @jsx jsx */\nimport { jsx } from \"@emotion/core\"\nimport React from \"react\"\nimport { Theme } from \"../../theme\"\n\nexport type LipShadowPosition = `top` | `bottom`\n\nexport type StickyObserverContextValue = {\n  isStuck: boolean\n  lipShadowPosition: LipShadowPosition\n  setIsIntersecting: (isIntersecting: boolean) => void\n}\n\nconst StickyObserverContext = React.createContext<StickyObserverContextValue>({\n  isStuck: false,\n  lipShadowPosition: `bottom`,\n  setIsIntersecting: () => undefined,\n})\n\nexport type StickyObserverProps = StickyObservedContainerProps & {\n  lipShadowPosition: LipShadowPosition\n}\n\n// This component is a shorthand; use\n//  - StickyObserverProvider,\n//  - StickyObservedContainer\n//  - StickyObserverSentinel\n//  - StickyLipShadow\n// if you need more control over DOM structure,\nexport function StickyObserver({\n  lipShadowPosition,\n  children,\n  ...rest\n}: StickyObserverProps) {\n  return (\n    <StickyObserverProvider lipShadowPosition={lipShadowPosition}>\n      <StickyObservedContainer {...rest}>{children}</StickyObservedContainer>\n    </StickyObserverProvider>\n  )\n}\n\nexport type StickyObserverProviderProps = {\n  lipShadowPosition: LipShadowPosition\n  children: React.ReactNode\n}\n\nexport function StickyObserverProvider({\n  lipShadowPosition,\n  children,\n}: StickyObserverProviderProps) {\n  const [isIntersecting, setIsIntersecting] = React.useState<boolean>(false)\n\n  const contextValue: StickyObserverContextValue = {\n    isStuck: isIntersecting,\n    setIsIntersecting,\n    lipShadowPosition,\n  }\n\n  return (\n    <StickyObserverContext.Provider value={contextValue}>\n      {children}\n    </StickyObserverContext.Provider>\n  )\n}\n\nexport function useStickyObserver(): StickyObserverContextValue {\n  return React.useContext(StickyObserverContext)\n}\n\nexport type StickyObservedContainerProps = Omit<\n  JSX.IntrinsicElements[\"div\"],\n  \"ref\"\n>\n\nexport function StickyObservedContainer({\n  children,\n  ...rest\n}: StickyObservedContainerProps) {\n  const { lipShadowPosition } = useStickyObserver()\n\n  return (\n    <React.Fragment>\n      {lipShadowPosition === `bottom` && <StickyObserverSentinel />}\n      <StickyObserverSentinel />\n      <div\n        css={[\n          {\n            position: \"sticky\",\n            zIndex: 1,\n            left: 0,\n            width: \"100%\",\n          },\n          lipShadowPosition === `top` && { bottom: 0 },\n          lipShadowPosition === `bottom` && { top: 0 },\n        ]}\n        {...rest}\n      >\n        {lipShadowPosition === `top` && <StickyLipShadow />}\n        {children}\n        {lipShadowPosition === `bottom` && <StickyLipShadow />}\n      </div>\n      {lipShadowPosition === `top` && <StickyObserverSentinel />}\n    </React.Fragment>\n  )\n}\n\nexport type StickyObserverSentinelProps = {}\n\n// A \"sentinel\" is a hack DIV element that is rendered next to the sticky element:\n//  - before the sticky element if it sticks to the top\n//  - after the sticky element if it sticks to the bottom\n// IntersectionObserver does not work properly for elements with position: sticky,\n// and this is why this \"sentinel\" is needed if we want to use Intersection API to identify\n// whether a sticky element has \"stuck\".\n//\n// When the sticky element gets \"stuck\", it pushes the sentinel away from the screen, triggering an intersection entry\n// When the sticky element gets \"unstuck\", the sentinel appears on the screen, triggering an intersection entry\nexport function StickyObserverSentinel(_props: StickyObserverSentinelProps) {\n  const { setIsIntersecting, lipShadowPosition } = useStickyObserver()\n  const sentinelRef = React.useRef<HTMLDivElement | null>(null)\n  const observerRef = React.useRef<IntersectionObserver | null>(null)\n\n  React.useEffect(() => {\n    if (!sentinelRef.current) {\n      return\n    }\n\n    observerRef.current = new IntersectionObserver(\n      entries => {\n        if (entries[0].intersectionRatio === 0) {\n          setIsIntersecting(true)\n        } else if (entries[0].intersectionRatio === 1) {\n          setIsIntersecting(false)\n        }\n      },\n      {\n        threshold: [0, 1],\n      }\n    )\n\n    observerRef.current.observe(sentinelRef.current)\n\n    return () => {\n      if (observerRef.current) {\n        observerRef.current.disconnect()\n      }\n    }\n  }, [lipShadowPosition, sentinelRef.current])\n\n  return <div ref={sentinelRef} css={{ height: `1px` }} aria-hidden />\n}\n\nexport type StickyLipShadowProps = {}\n\n// Lip shadows MUST be rendered as children of the sticky element for proper positioning\nexport function StickyLipShadow(_props: StickyLipShadowProps) {\n  const { isStuck, lipShadowPosition } = useStickyObserver()\n\n  return (\n    <div\n      data-sticky-lip-visible={isStuck}\n      css={(theme: Theme) => [\n        {\n          height: 0,\n          position: `relative`,\n          \":before\": {\n            content: '\"\"',\n            display: `block`,\n            position: `absolute`,\n            left: 0,\n            right: 0,\n            height: 1,\n            transition: `box-lip ${theme.transitions.default}`,\n            boxShadow: `none`,\n          },\n        },\n        lipShadowPosition === `top` && {\n          \":before\": {\n            top: 0,\n          },\n          '&[data-sticky-lip-visible=\"true\"]:before': {\n            boxShadow: getLipBoxShadow(theme, `top`),\n          },\n        },\n        lipShadowPosition === `bottom` && {\n          \":before\": {\n            bottom: 0,\n          },\n          '&[data-sticky-lip-visible=\"true\"]:before': {\n            boxShadow: getLipBoxShadow(theme, `bottom`),\n          },\n        },\n      ]}\n    />\n  )\n}\n\nfunction getLipBoxShadow(theme: Theme, shadowDirection: LipShadowPosition) {\n  return `\n        0px ${shadowDirection === \"top\" ? -2 : 2}px 2px ${\n    theme.colors.blackFade[20]\n  },\n        0px ${shadowDirection === \"top\" ? -4 : 4}px 4px ${\n    theme.colors.blackFade[40]\n  }\n    `\n}\n"],"names":["StickyObserverContext","React","createContext","isStuck","lipShadowPosition","setIsIntersecting","undefined","StickyObserver","children","rest","StickyObserverProvider","useState","isIntersecting","contextValue","useStickyObserver","useContext","StickyObservedContainer","position","zIndex","left","width","bottom","top","StickyObserverSentinel","_props","sentinelRef","useRef","observerRef","useEffect","current","IntersectionObserver","entries","intersectionRatio","threshold","observe","disconnect","height","StickyLipShadow","theme","content","display","right","transition","transitions","boxShadow","getLipBoxShadow","shadowDirection","colors","blackFade"],"mappings":"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"}