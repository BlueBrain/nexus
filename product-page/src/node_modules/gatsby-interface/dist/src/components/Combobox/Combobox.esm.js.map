{"version":3,"file":"Combobox.esm.js","sources":["../../../../src/components/Combobox/Combobox.tsx"],"sourcesContent":["/** @jsx jsx */\nimport { jsx } from \"@emotion/core\"\nimport React from \"react\"\nimport {\n  Combobox as ReachCombobox,\n  ComboboxProps as ReachComboboxProps,\n  ComboboxInput as ReachComboboxInput,\n  ComboboxInputProps as ReachComboboxInputProps,\n  ComboboxPopover as ReachComboboxPopover,\n  ComboboxPopoverProps as ReachComboboxPopoverProps,\n  ComboboxList as ReachComboboxList,\n  ComboboxListProps as ReachComboboxListProps,\n  ComboboxOption as ReachComboboxOption,\n  ComboboxOptionProps as ReachComboboxOptionProps,\n  ComboboxOptionText as ReachComboboxOptionText,\n  useComboboxContext as useReachComboboxContext,\n} from \"@reach/combobox\"\nimport { PopoverProps } from \"@reach/popover\"\nimport { PropsWithAs } from \"@reach/utils\"\nimport { MdDone } from \"react-icons/md\"\nimport {\n  comboboxCss,\n  inputCss,\n  popoverCss,\n  listCss,\n  optionCss,\n  selectedOptionIconCss,\n  selectedValueCss,\n  inputWithSelectedValueCss,\n} from \"./Combobox.styles\"\nimport { warn } from \"../../utils/maintenance/warn\"\nimport { RequireProp } from \"../../utils/types\"\nimport { DisableReachStyleCheck } from \"../../utils/helpers/DisableReachStyleCheck\"\n\ntype ComboboxCustomContextValue = {\n  listRef: React.RefObject<HTMLUListElement>\n}\n\nconst ComboboxCustomContext = React.createContext<ComboboxCustomContextValue>({\n  listRef: {\n    current: null,\n  },\n})\n\nfunction useComboboxCustomContext(): ComboboxCustomContextValue {\n  return React.useContext(ComboboxCustomContext)\n}\n\nexport type ComboboxProps = PropsWithAs<\"div\", ReachComboboxProps>\n\nexport function Combobox(props: ComboboxProps) {\n  const listRef = React.useRef<HTMLUListElement>(null)\n\n  return (\n    <ComboboxCustomContext.Provider value={{ listRef }}>\n      <DisableReachStyleCheck reachComponent=\"combobox\" />\n      <ReachCombobox openOnFocus css={comboboxCss} {...props} />\n    </ComboboxCustomContext.Provider>\n  )\n}\n\nexport type ComboboxInputProps = PropsWithAs<\n  \"input\",\n  ReachComboboxInputProps & {\n    selectedOptionLabel?: string\n    hasError?: boolean\n  }\n>\n\nexport const ComboboxInput = React.forwardRef<\n  HTMLInputElement,\n  ComboboxInputProps\n>(function ComboboxInput({ selectedOptionLabel, hasError, ...delegated }, ref) {\n  const { listRef } = useComboboxCustomContext()\n\n  /**\n   * This handler allows to scroll list of options along with keyboard navigation\n   *\n   * This solution has been suggested in one of the replies:\n   * https://github.com/reach/reach-ui/issues/357#issuecomment-575849548\n   */\n  const onKeyDown: React.KeyboardEventHandler<HTMLInputElement> = event => {\n    if (event.isDefaultPrevented()) {\n      return\n    }\n\n    const container = listRef.current\n    if (!container) {\n      return\n    }\n\n    // According to the original Github comment, using \"requestAnimationFrame\" makes\n    // scrolling work when navigating from last item to first item and vice versa\n    window.requestAnimationFrame(() => {\n      const element = container.querySelector(\n        \"[aria-selected=true]\"\n      ) as HTMLLIElement\n\n      if (!element) {\n        return\n      }\n\n      const top = element.offsetTop - container.scrollTop\n      const bottom =\n        container.scrollTop +\n        container.clientHeight -\n        (element.offsetTop + element.clientHeight)\n\n      if (bottom < 0) container.scrollTop -= bottom\n      if (top < 0) container.scrollTop += top\n    })\n  }\n\n  let showSelectedOptionLabel = !!selectedOptionLabel\n  if (delegated.value === selectedOptionLabel) {\n    showSelectedOptionLabel = false\n  }\n\n  return (\n    <div css={{ position: \"relative\" }}>\n      <ReachComboboxInput\n        ref={ref}\n        selectOnClick\n        onKeyDown={onKeyDown}\n        css={theme => [\n          inputCss(hasError)(theme),\n          showSelectedOptionLabel && inputWithSelectedValueCss(theme),\n        ]}\n        {...delegated}\n      />\n      {!!selectedOptionLabel && (\n        <span aria-hidden css={selectedValueCss}>\n          {selectedOptionLabel}\n        </span>\n      )}\n    </div>\n  )\n})\n\nexport type ComboboxPopoverProps = PropsWithAs<\n  \"div\",\n  ReachComboboxPopoverProps &\n    Partial<PopoverProps> &\n    React.RefAttributes<HTMLDivElement>\n>\n\nexport const ComboboxPopover = React.forwardRef<\n  HTMLInputElement,\n  ComboboxPopoverProps\n>(function ComboboxPopover(props, ref) {\n  return (\n    <ReachComboboxPopover ref={ref} portal={true} css={popoverCss} {...props} />\n  )\n})\n\ntype ComboboxListBaseProps = PropsWithAs<\"ul\", ReachComboboxListProps>\n\n/**\n * ComboboxList renders an element with role=\"listbox\"\n * which must have an accessible name (https://dequeuniversity.com/rules/axe/3.5/aria-input-field-name?application=AxeChrome)\n * therefore we require \"aria-label\" or \"aria-labelledby\" to be passed\n */\nexport type ComboboxListProps =\n  | RequireProp<ComboboxListBaseProps, \"aria-label\">\n  | RequireProp<ComboboxListBaseProps, \"aria-labelledby\">\n\nexport function ComboboxList(props: ComboboxListProps) {\n  const { listRef } = useComboboxCustomContext()\n\n  if (process.env.NODE_ENV === `development`) {\n    const hasAccessibleName = Boolean(\n      props[\"aria-label\"] || props[\"aria-labelledby\"]\n    )\n    if (!hasAccessibleName) {\n      warn(\n        `<ComboboxList /> is missing one of the required props: \"aria-label\", \"aria-labelledby\"`\n      )\n    }\n  }\n\n  return (\n    <ReachComboboxList\n      ref={listRef}\n      persistSelection\n      css={listCss}\n      {...props}\n    />\n  )\n}\n\nexport type ComboboxOptionProps = PropsWithAs<\n  \"li\",\n  ReachComboboxOptionProps & {\n    selected?: boolean\n    selectedAriaLabel?: string\n    highlightMatches?: boolean\n  }\n>\n\nexport const ComboboxOption = React.forwardRef<\n  HTMLLIElement,\n  ComboboxOptionProps\n>(function ComboboxOption(\n  {\n    selected,\n    selectedAriaLabel = \"currently selected:\",\n    highlightMatches = true,\n    value,\n    children,\n    ...delegated\n  },\n  ref\n) {\n  return (\n    <ReachComboboxOption\n      ref={ref}\n      value={value}\n      css={optionCss(highlightMatches)}\n      {...delegated}\n    >\n      {selected && (\n        <MdDone css={selectedOptionIconCss} aria-label={selectedAriaLabel} />\n      )}\n      {children || (highlightMatches ? <ComboboxOptionText /> : value)}\n    </ReachComboboxOption>\n  )\n})\n\nexport type ComboboxOptionTextProps = {}\n\nexport function ComboboxOptionText(props: ComboboxOptionTextProps) {\n  return <ReachComboboxOptionText {...props} />\n}\n\nexport function useComboboxContext() {\n  return useReachComboboxContext()\n}\n"],"names":["ComboboxCustomContext","React","createContext","listRef","current","useComboboxCustomContext","useContext","Combobox","props","useRef","ReachCombobox","comboboxCss","ComboboxInput","forwardRef","ref","selectedOptionLabel","hasError","delegated","onKeyDown","event","isDefaultPrevented","container","window","requestAnimationFrame","element","querySelector","top","offsetTop","scrollTop","bottom","clientHeight","showSelectedOptionLabel","value","position","ReachComboboxInput","theme","inputCss","inputWithSelectedValueCss","selectedValueCss","ComboboxPopover","ReachComboboxPopover","popoverCss","ComboboxList","process","env","NODE_ENV","hasAccessibleName","Boolean","warn","ReachComboboxList","listCss","ComboboxOption","selected","selectedAriaLabel","highlightMatches","children","ReachComboboxOption","optionCss","selectedOptionIconCss","ComboboxOptionText","ReachComboboxOptionText","useComboboxContext","useReachComboboxContext"],"mappings":"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"}