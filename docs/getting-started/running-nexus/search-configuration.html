<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.5.1, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../.././assets/img/favicon-32x32.png">
<title>Search configuration · Blue Brain Nexus</title>
<link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
<meta name="theme-color" content="#03a9f4" />
<link rel="stylesheet" href="../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../lib/prettify/prettify.css">
<script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../../.././assets/css/docs.css">
</head>
<body
data-md-color-primary="light-blue"
data-md-color-accent="cyan"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../docs/index.html" title="Blue Brain Nexus" class="md-header-nav__button md-logo">
<img src="../../.././assets/img/logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Blue Brain Nexus
</span>
<span class="md-header-nav__topic">
Search configuration
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/BlueBrain/nexus"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
BlueBrain/nexus
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../docs/index.html" title="Blue Brain Nexus" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../../.././assets/img/logo.png" width="24" height="24">
</a>
<a href="../../../docs/index.html" title="Blue Brain Nexus">
Blue Brain Nexus
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/BlueBrain/nexus"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
BlueBrain/nexus
</div>
</a>

</div>
<ul>
  <li><a href="../../../docs/versions.html" class="page">Versions</a></li>
  <li><a href="../../../docs/getting-started/index.html" class="page">Getting Started</a>
  <ul>
    <li><a href="../../../docs/getting-started/understanding-knowledge-graphs.html" class="page">Understanding Knowledge Graphs</a></li>
    <li><a href="../../../docs/getting-started/try-nexus.html" class="page">Try Nexus with Neuroscience Datasets</a></li>
    <li><a href="../../../docs/getting-started/try-nexus-movielens.html" class="page">Try Nexus with the MovieLens Dataset</a></li>
    <li><a href="../../../docs/getting-started/running-nexus/index.html" class="page">Running Nexus</a>
    <ul>
      <li><a href="../../../docs/getting-started/running-nexus/configuration/index.html" class="page">Nexus configuration</a></li>
      <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html" class="active page">Search configuration</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../../../docs/releases/index.html" class="page">Releases</a>
  <ul>
    <li><a href="../../../docs/releases/v1.7-release-notes.html" class="page">v1.7 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.6-to-v1.7-migration.html" class="page">v1.6 To v1.7 Migration</a></li>
    <li><a href="../../../docs/releases/v1.6-release-notes.html" class="page">v1.6 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.5-to-v1.6-migration.html" class="page">v1.5 To v1.6 Migration</a></li>
    <li><a href="../../../docs/releases/v1.5-release-notes.html" class="page">v1.5 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.4-to-v1.5-migration.html" class="page">v1.4 To v1.5 Migration</a></li>
    <li><a href="../../../docs/releases/v1.4-release-notes.html" class="page">v1.4 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.3-to-v1.4-migration.html" class="page">v1.3 To v1.4 Migration</a></li>
    <li><a href="../../../docs/releases/v1.3-release-notes.html" class="page">v1.3 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.2-to-v1.3-migration.html" class="page">v1.2 To v1.3 Migration</a></li>
    <li><a href="../../../docs/releases/v1.2-release-notes.html" class="page">v1.2 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.1-release-notes.html" class="page">v1.1 Release Notes</a></li>
    <li><a href="../../../docs/releases/v1.0-to-v1.1-migration.html" class="page">v1.0 To v1.1 Migration</a></li>
    <li><a href="../../../docs/releases/v1.0-release-notes.html" class="page">v1.0 Release Notes</a></li>
  </ul></li>
  <li><a href="../../../docs/roadmap.html" class="page">Roadmap</a></li>
  <li><a href="../../../docs/fusion/index.html" class="page">Nexus Fusion</a>
  <ul>
    <li><a href="../../../docs/fusion/architecture.html" class="page">Architecture</a></li>
    <li><a href="../../../docs/fusion/plugins.html" class="page">Plugins</a></li>
    <li><a href="../../../docs/fusion/studio.html" class="page">Studios</a></li>
    <li><a href="../../../docs/fusion/search.html" class="page">Search</a></li>
    <li><a href="../../../docs/fusion/admin.html" class="page">Admin</a></li>
    <li><a href="../../../docs/fusion/workflow.html" class="page">Workflow (alpha)</a></li>
    <li><a href="../../../docs/fusion/add-your-own-app.html" class="page">Add your own App</a></li>
  </ul></li>
  <li><a href="../../../docs/forge.html" class="page">Nexus Forge</a></li>
  <li><a href="../../../docs/delta/index.html" class="page">Nexus Delta</a>
  <ul>
    <li><a href="../../../docs/delta/architecture.html" class="page">Architecture</a></li>
    <li><a href="../../../docs/delta/api/index.html" class="page">API Reference</a>
    <ul>
      <li><a href="../../../docs/delta/api/content-negotiation.html" class="page">Content Negotiation</a></li>
      <li><a href="../../../docs/delta/api/error-signaling.html" class="page">Error Signaling</a></li>
      <li><a href="../../../docs/delta/api/version.html" class="page">Version</a></li>
      <li><a href="../../../docs/delta/api/authentication.html" class="page">Authentication &amp; Authorization</a></li>
      <li><a href="../../../docs/delta/api/identities.html" class="page">Identities</a></li>
      <li><a href="../../../docs/delta/api/permissions-api.html" class="page">Permissions</a></li>
      <li><a href="../../../docs/delta/api/realms-api.html" class="page">Realms</a></li>
      <li><a href="../../../docs/delta/api/acls-api.html" class="page">Access Control Lists</a></li>
      <li><a href="../../../docs/delta/api/orgs-api.html" class="page">Organizations</a></li>
      <li><a href="../../../docs/delta/api/projects-api.html" class="page">Projects</a></li>
      <li><a href="../../../docs/delta/api/quotas.html" class="page">Quotas</a></li>
      <li><a href="../../../docs/delta/api/schemas-api.html" class="page">Schemas</a></li>
      <li><a href="../../../docs/delta/api/resources-api.html" class="page">Resources</a></li>
      <li><a href="../../../docs/delta/api/resolvers-api.html" class="page">Resolvers</a></li>
      <li><a href="../../../docs/delta/api/views/index.html" class="page">Views</a>
      <ul>
        <li><a href="../../../docs/delta/api/views/elasticsearch-view-api.html" class="page">ElasticSearchView</a></li>
        <li><a href="../../../docs/delta/api/views/pipes.html" class="page">Elasticsearch Pipes</a></li>
        <li><a href="../../../docs/delta/api/views/aggregated-es-view-api.html" class="page">AggregateElasticSearchView</a></li>
        <li><a href="../../../docs/delta/api/views/sparql-view-api.html" class="page">SparqlView</a></li>
        <li><a href="../../../docs/delta/api/views/aggregated-sparql-view-api.html" class="page">AggregateSparqlView</a></li>
        <li><a href="../../../docs/delta/api/views/composite-view-api.html" class="page">CompositeView</a></li>
      </ul></li>
      <li><a href="../../../docs/delta/api/storages-api.html" class="page">Storages</a></li>
      <li><a href="../../../docs/delta/api/files-api.html" class="page">Files</a></li>
      <li><a href="../../../docs/delta/api/archives-api.html" class="page">Archives</a></li>
      <li><a href="../../../docs/delta/api/search-api.html" class="page">Global search</a></li>
      <li><a href="../../../docs/delta/api/graph-analytics-api.html" class="page">Graph analytics</a></li>
      <li><a href="../../../docs/delta/api/events-api.html" class="page">Global events</a></li>
    </ul></li>
    <li><a href="../../../docs/delta/plugins/index.html" class="page">Plugins</a></li>
    <li><a href="../../../docs/delta/benchmarks/index.html" class="page">Benchmarks</a>
    <ul>
      <li><a href="../../../docs/delta/benchmarks/v1.4.2.html" class="page">Benchmarks v1.4.2</a></li>
      <li><a href="../../../docs/delta/benchmarks/v1.2.1.html" class="page">Benchmarks v1.2.1</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../../../docs/utilities/index.html" class="page">Utilities</a></li>
  <li><a href="../../../docs/faq.html" class="page">FAQ</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html#search-configuration" class="header">Search configuration</a>
  <ul>
    <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html#how-global-search-works" class="header">How Global Search works</a></li>
    <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html#example-use-case" class="header">Example use case</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> v1.7.x
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html#search-configuration" class="header">Search configuration</a>
  <ul>
    <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html#how-global-search-works" class="header">How Global Search works</a></li>
    <li><a href="../../../docs/getting-started/running-nexus/search-configuration.html#example-use-case" class="header">Example use case</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#search-configuration" name="search-configuration" class="anchor"><span class="anchor-link"></span></a>Search configuration</h1>
<p>Nexus provides global search functionality across all projects through the <a href="https://github.com/BlueBrain/nexus/tree/v1.7.x/delta/plugins/search/src" title="search plugin" target="_blank" rel="noopener noreferrer">search plugin</a>.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>The search plugin is experimental and its functionality and API can change without notice.</p></div>
<p>There are several aspects that have been taken into consideration when adding global search capabilities in Nexus:</p>
<ul>
  <li>global search requires a common (index) data model for correct analysis, indexing and querying</li>
  <li>it must obey the configured access control (search results should include only entries that the client has access to)</li>
  <li>clients must be able to discover the data model in order to be able to build appropriate queries</li>
  <li>projects administrators should be able to control, reconfigure or opt out of presenting information in global search</li>
</ul>
<h2><a href="#how-global-search-works" name="how-global-search-works" class="anchor"><span class="anchor-link"></span></a>How Global Search works</h2>
<p>Considering the requirements listed above, the implementation relies on existing Nexus features, namely:</p>
<ul>
  <li><a href="../../delta/api/views/composite-view-api.html">Composite Views</a> as control resources for partitioning of indices,  how data is indexed, what information to collect, what permissions are required for querying</li>
  <li><a href="../../delta/plugins/index.html#dependency-injection">Automatic provisioning</a> of project resources after creation</li>
  <li><a href="../../delta/plugins/index.html">Plugins</a> for orchestrating the behaviour and exposing specific endpoints</li>
</ul>
<p>When the search plugin is enabled and configured it will automatically create within each project a CompositeView that controls what resources are indexed and what information is collected for each resource. The reasons for using one CompositeView per project are that resources shapes may differ between projects but also the indices must be partitioned such that when consuming the query interface, the query must be dispatched only to the indices that the client has access to. The CompositeView id is identical for each project: <code>https://bluebrain.github.io/nexus/vocabulary/searchView</code>.</p>
<p>Once the CompositeView is created by the plugin, it can be updated by each project administrator (specifically any client that demonstrates <code>views/write</code> permission on the target project) to adjust the configuration based on the specifics of the project (different access control, different resource shapes, custom selection of resources etc.).</p>
<p>CompositeViews have been chosen because they are quite versatile, support a wide range of configuration options:</p>
<ul>
  <li>multiple sources</li>
  <li>multiple projections (indices)</li>
  <li>project graph traversal for collecting the necessary fields</li>
  <li>simple transformations</li>
</ul>
<p>More information about CompositeViews can be found in the <a href="../../delta/api/views/composite-view-api.html">API Reference</a>.</p>
<p>The search plugin introduces a new namespace (<code>/v1/search</code>) with two sub-resources (<code>query</code> and <code>config</code>).</p>
<p>The <a href="../../delta/api/search-api.html#query">query endpoint</a> accepts submitting an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html" title="Elasticsearch query">Elasticsearch query</a> via <code>POST</code>, similar to other views based on Elasticsearch, like <code>ElasticSearchView</code>, <code>AggregateElasticSearchView</code> or <code>CompositeView</code> with configured Elasticsearch projections. The query will be dispatched to all ElasticSearch indices managed by the CompositeViews created by the search plugin (the ones that share the id mentioned above) for which the client has access to. This ensures that access to information is restricted based on each project&rsquo;s access control.</p>
<p>The <a href="../../delta/api/search-api.html#configuration">config endpoint</a> allows clients to discover the underlying index data model such that it can present users (like in the case of Fusion) an appropriate interface for querying, filtering, sorting, aggregations etc. A minimal response for the config endpoint is like the following example:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;fields&quot;: [
    {
      &quot;name&quot;: &quot;project&quot;,
      &quot;label&quot;: &quot;Project&quot;,
      &quot;array&quot;: false,
      &quot;optional&quot;: false,
      &quot;fields&quot;: [
        {
          &quot;name&quot;: &quot;identifier&quot;,
          &quot;format&quot;: [
            &quot;uri&quot;
          ],
          &quot;optional&quot;: false
        },
        {
          &quot;name&quot;: &quot;label&quot;,
          &quot;format&quot;: [
            &quot;keyword&quot;,
            &quot;text&quot;
          ],
          &quot;optional&quot;: false
        }
      ]
    },
    {
      &quot;name&quot;: &quot;@type&quot;,
      &quot;label&quot;: &quot;Types&quot;,
      &quot;array&quot;: true,
      &quot;optional&quot;: false,
      &quot;format&quot;: [
        &quot;uri&quot;
      ]
    }
  ]
}
</code></pre>
<p>&hellip; where the returned document describes a set of fields to be expected in the indices:</p>
<ul>
  <li><code>name</code>: String - the name of the field in the Elasticsearch document</li>
  <li><code>label</code>: String - a human-readable label to be presented to users</li>
  <li><code>array</code>: Boolean - true if the field can have multiple values, false otherwise</li>
  <li><code>optional</code>: Boolean - true if the field may not exist in certain documents, false otherwise</li>
  <li><code>format</code>: Array(String) - the expected formats of the field (e.g. <code>uri</code>, <code>keyword</code>, <code>text</code>, <code>boolean</code>, <code>number</code> etc.);  <code>format</code> and <code>fields</code> cannot be present at the same time</li>
  <li><code>fields</code>: Array(Object) - enumeration of nested fields; there are situations where a field value can (should) be handled  differently depending on the intent, like for example ontological values that are represented by a Uri but also a  String (name or label). Clients should be aware of such case to understand what to present to their users but also  how to properly compute queries. <code>format</code> and <code>fields</code> cannot be present at the same time</li>
  <li><code>fields.name</code>: String - the name of the sub-field in the Elasticsearch document</li>
  <li><code>fields.format</code>: Array(String) - the expected formats of the field (e.g. <code>uri</code>, <code>keyword</code>, <code>text</code>, <code>boolean</code>, <code>number</code> etc.)</li>
  <li><code>fields.optional</code>: Boolean - true if the field may not exist in certain documents, false otherwise</li>
</ul>
<p>The config endpoint was created to allow clients to discover how resources are indexed and can be queried. It is currently loaded as a static file (<code>plugins.search.fields={pathToFile}</code>) during Delta&rsquo;s bootstrapping, and it must match the rest of the search configuration:</p>
<ul>
  <li><code>plugins.search.indexing.resource-types={pathToFile}</code> - the list of types which will be used to filter resources to be  indexed in the ElasticSearch projection</li>
  <li><code>plugins.search.indexing.query={pathToFile}</code> - SPARQL construct query that will be used to create triples which will  be then compacted using the provided context and indexed in the ElasticSearch projection</li>
  <li><code>plugins.search.indexing.context={pathToFile}</code> - the context which is used to transform the results of the SPARQL  construct query into compacted JSON-LD which will be indexed in the ElasticSearch projection</li>
  <li><code>plugins.search.indexing.mapping={pathToFile}</code> - the Elasticsearch mappings that will be used in the ElasticSearch  projection</li>
  <li><code>plugins.search.indexing.settings={pathToFile}</code>- additional Elasticsearch settings that will be used in the  ElasticSearch projection</li>
</ul>
<p>The search plugin must also be enabled using the <code>plugins.search.enabled=true</code> setting.</p>
<p>These additional settings pertain to the configuration of the CompositeViews that are automatically provisioned by the search plugin. The <a href="../../delta/api/views/composite-view-api.html">CompositeView API Reference</a> provides a detailed explanation on how CompositeViews work and how these options affect the generation of the indices.</p>
<h2><a href="#example-use-case" name="example-use-case" class="anchor"><span class="anchor-link"></span></a>Example use case</h2>
<p>This section describes a search configuration for a hypothetical data model presented in the diagram below. The example uses four related data types (<code>Dataset</code>, <code>DataDownload</code>, <code>Person</code> and <code>License</code>) and the intent is to provide the ability to query resources of type <code>Dataset</code> along with information registered in related resources (of type <code>DataDownload</code>, <code>Person</code> or <code>License</code>).</p>
<p><a href="../assets/search-use-case.png"><img src="../assets/search-use-case.png" alt="Data Model" title="Data Model" /></a></p>
<p>There are a couple of things to notice in the data model diagram:</p>
<ul>
  <li><code>schema:name</code> and <code>rdfs:label</code> are both optional but mostly used for the same purpose; the information should be  collected from one with a fallback on the other</li>
  <li><code>schema:license</code> is also optional, not all datasets may have a license</li>
  <li>when some fields are marked as optional it means that the resource of type <code>Dataset</code> may not include those fields, but  this doesn&rsquo;t mean that all related resources exist (a <code>Dataset</code> may refer to a <code>Person</code> that does not exist in the project)</li>
</ul>
<p>The goal is that indexing will produce Elasticsearch documents that has the following structure:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;@id&quot;: &quot;...&quot;,
  &quot;@type&quot;: [&quot;http://schema.org/Dataset&quot;, &quot;http://other...&quot;],
  &quot;name&quot;: &quot;&lt;name or label&gt;&quot;,
  &quot;description&quot;: &quot;...&quot;,
  &quot;author&quot;: &quot;&lt;givenName&gt; &lt;familyName&gt; if exists&quot;,
  &quot;license&quot;: &quot;&lt;label&gt; if exists&quot;,
  &quot;distributionContentUrl&quot;: &quot;...&quot;,
  &quot;distributionEncodingFormat&quot;: &quot;...&quot;,
  &quot;distributionSize&quot;: &quot;&lt;value&gt; &lt;unitCode&gt;&quot;,
  &quot;self&quot;: &quot;...&quot;,
  &quot;createdAt&quot;: &quot;...&quot;
}
</code></pre>
<p>The first step is to define which types of resources should be considered for indexing as a JSON document (provided via the <code>plugins.search.indexing.resource-types={pathToFile}</code> setting). In this example the intent is to index only resources of type <code>Dataset</code>, but there are situations where a more specific list of types should be considered.</p>
<pre class="prettyprint"><code class="language-json">[
  &quot;http://schema.org/Dataset&quot;
]
</code></pre>
<p>The next step is to write the appropriate SPARQL query that collects the required information by traversing the RDF graph maintained by the CompositeView. The type of query that is required is a <code>CONSTRUCT</code> query, where one can create a new RDF graph based on the information collected from the original graph. The <code>CONSTRUCT</code> query is provided to Delta using the <code>plugins.search.indexing.query={pathToFile}</code> setting.</p>
<pre><code>prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
prefix schema: &lt;http://schema.org/&gt;
prefix nxv: &lt;https://bluebrain.github.io/nexus/vocabulary/&gt;
prefix f: &lt;http://localhost/field/&gt; # this is the new namespace to be used for
                                    # all fields; using a separate namespace
                                    # simplifies the transformation of the new
                                    # RDF graph to JSON.

CONSTRUCT {
  {resource_id}  a                             ?type ;
                 f:name                        ?nameOrLabel ;
                 f:description                 ?description ;
                 f:author                      ?author ;
                 f:license                     ?license ;
                 f:self                        ?self ;
                 f:createdAt                   ?createdAt ;
                 f:distributionContentUrl      ?contentUrl ;
                 f:distributionEncodingFormat  ?encodingFormat ;
                 f:distributionSize            ?size .
}
WHERE {
  # bind first all values that must exist for the document to be produced
  {resource_id}  a                                                    ?type ;
                 schema:description                                   ?description ;
                 nxv:self                                             ?self ;
                 nxv:createdAt                                        ?createdAt ;
                 schema:distribution / schema:contentUrl              ?contentUrl ;
                 schema:distribution / schema:encodingFormat          ?encodingFormat ;
                 schema:distribution / schema:size / schema:unitCode  ?unitCode ;
                 schema:distribution / schema:size / schema:value     ?value .

  # create the size value by concatenating the distribution size value and unitCode
  BIND (CONCAT(STR(?value), STR(&quot; &quot;), STR(?unitCode)) as ?size) .

  # bind shema:name or rdfs:label
  OPTIONAL { {resource_id} schema:name  ?name } .
  OPTIONAL { {resource_id} rdfs:label  ?label } .
  BIND (IF(BOUND(?name), ?name, ?label) as ?nameOrLabel).

  # bind optional author
  OPTIONAL {
    {resource_id}  schema:author     ?personId .
    ?personId      a                 schema:Person ;
                   schema:givenName  ?givenName ;
                   schema:familyName ?familyName .
    BIND (CONCAT(?givenName, STR(&quot; &quot;), ?familyName) as ?author) .
  }

  # bind optional license
  OPTIONAL {
    {resource_id}  schema:license  ?licenceId .
    ?licenceId     a               schema:License ;
                   rdfs:label      ?license .
  }
}
</code></pre>
<p>The <code>CONSTRUCT</code> query example above may seem intimidating, but the gist of it is the following:</p>
<ul>
  <li>it is generating a new RDF graph (the one described in the <code>CONSTRUCT</code> block) using values collected (bound) by  following the original RDF graph relationships (the ones described in the <code>WHERE</code> block)</li>
  <li>the entrypoint for the query is always the current resource id (for which the query is being run) which is filled in  by the system by replacing <code>{resouce_id}</code> with the actual value. Note: this query is executed to produce the new graph  each type a resource identified by <code>{resource_id}</code> is created, updated or deprecated such that the corresponding  Elasticsearch document is created, updated or deleted</li>
  <li>the <code>BIND</code> statements merely assigns a value to a variable, sometimes using a conditional statement or by  concatenating the values of two existing variables</li>
  <li>the <code>OPTIONAL</code> blocks instruct the generation of the new RDF graph to ignore the cases where the variables described  within cannot be bound (usually because they are not found); so, for example: the statement  <code>?licenceId a schema:License</code> may not match because the referred license (<code>{resource_id}  schema:license  ?licenceId</code>)  does not have the type <code>schema:License</code>; in this case the <code>?license</code> variable will not be bound and the field will be  ignored in the new RDF graph; if these statements would not have been encased in an <code>OPTIONAL</code> block, a new RDF graph  would not be generated resulting in a missing document in the index</li>
</ul>
<p>The next step is to define the context that when applied to the resulting RDF graph (the one created by executing the <code>CONSTRUCT</code> query) it will produce the Elasticsearch document. Because all the predicates in the query used the <code>f</code> prefix (the <code>http://localhost/field/</code> namespace) the context document (provided via the <code>plugins.search.indexing.context={pathToFile}</code> setting) becomes quite simple:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;@vocab&quot;: &quot;http://localhost/field/&quot;,
  &quot;createdAt&quot;: {
    &quot;@type&quot;: &quot;http://www.w3.org/2001/XMLSchema#dateTime&quot;
  }
}
</code></pre>
<p>The next step is to define the Elasticsearch index setting (provided via the <code>plugins.search.indexing.settings={pathToFile}</code> setting) that will configure how fields are analysed, number of shards etc. The following example would work for most cases where values are word split, trimmed and set to lowercase. The number of shards depends on the volume of data that will be indexed (see the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/size-your-shards.html" title="Elasticsearch recommendation">Elasticsearch recommendation</a>).</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;analysis&quot;: {
    &quot;analyzer&quot;: {
      &quot;nexus&quot;: {
        &quot;type&quot;: &quot;custom&quot;,
        &quot;tokenizer&quot;: &quot;classic&quot;,
        &quot;filter&quot;: [
          &quot;trim&quot;,
          &quot;word_delimiter_nexus&quot;,
          &quot;lowercase&quot;
        ]
      }
    },
    &quot;filter&quot;: {
      &quot;word_delimiter_nexus&quot;: {
        &quot;type&quot;: &quot;word_delimiter_graph&quot;,
        &quot;split_on_numerics&quot;: false,
        &quot;preserve_original&quot;: true
      }
    }
  },
  &quot;index&quot;: {
    &quot;number_of_shards&quot;: 1
  }
}
</code></pre>
<p>The next step is to define the Elasticsearch mapping (provided via the <code>plugins.search.indexing.mapping={pathToFile}</code> setting) that will instruct Elasticsearch how to interpret the values in the documents. A lot of customisations can be defined, but the following example shows the use of <code>dynamic_templates</code> to handle all text fields except for <code>@id</code> and <code>self</code> which should be handled as keywords only.</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;dynamic_templates&quot;: [
    {
      &quot;strings&quot;: {
        &quot;match_mapping_type&quot;: &quot;string&quot;,
        &quot;mapping&quot;: {
          &quot;type&quot;: &quot;text&quot;,
          &quot;analyzer&quot;: &quot;nexus&quot;,
          &quot;fields&quot;: {
            &quot;keyword&quot;: {
              &quot;type&quot;: &quot;keyword&quot;
            }
          }
        }
      }
    }
  ],
  &quot;properties&quot;: {
    &quot;@id&quot;: {
      &quot;type&quot;: &quot;keyword&quot;
    },
    &quot;self&quot;: {
      &quot;type&quot;: &quot;keyword&quot;
    }
  }
}
</code></pre>
<p>The final step is to define the config JSON document (provided via the <code>plugins.search.fields={pathToFile}</code> setting) that the <code>/v1/search/config</code> endpoint will return as means of data model discovery:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;fields&quot;: [
    {
      &quot;array&quot;: true,
      &quot;format&quot;: [
        &quot;uri&quot;
      ],
      &quot;label&quot;: &quot;Types&quot;,
      &quot;name&quot;: &quot;@type&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;text&quot;
      ],
      &quot;label&quot;: &quot;Name&quot;,
      &quot;name&quot;: &quot;name&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;text&quot;
      ],
      &quot;label&quot;: &quot;Description&quot;,
      &quot;name&quot;: &quot;description&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;uri&quot;
      ],
      &quot;label&quot;: &quot;Download&quot;,
      &quot;name&quot;: &quot;distributionContentUrl&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;keyword&quot;
      ],
      &quot;label&quot;: &quot;Media Type&quot;,
      &quot;name&quot;: &quot;distributionEncodingFormat&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;text&quot;
      ],
      &quot;label&quot;: &quot;Content Size&quot;,
      &quot;name&quot;: &quot;distributionSize&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;text&quot;
      ],
      &quot;label&quot;: &quot;Author&quot;,
      &quot;name&quot;: &quot;author&quot;,
      &quot;optional&quot;: true
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;text&quot;
      ],
      &quot;label&quot;: &quot;License&quot;,
      &quot;name&quot;: &quot;license&quot;,
      &quot;optional&quot;: true
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;text&quot;
      ],
      &quot;label&quot;: &quot;Created&quot;,
      &quot;name&quot;: &quot;createdAt&quot;,
      &quot;optional&quot;: false
    },
    {
      &quot;array&quot;: false,
      &quot;format&quot;: [
        &quot;uri&quot;
      ],
      &quot;label&quot;: &quot;Resource Address&quot;,
      &quot;name&quot;: &quot;self&quot;,
      &quot;optional&quot;: false
    }
  ]
}
</code></pre>
<p>This completes the configuration required to enable Global Search capabilities into Nexus. It may seem quite cumbersome, but all the configuration options presented are required for a good end-user experience. A different, more complex configuration example can be found in the <a href="https://github.com/BlueBrain/nexus/tree/v1.7.x/tests/docker/config" title="test project">test project</a>.</p>
</div>
<div>
<a href="https://github.com/BlueBrain/nexus/tree/master/docs/src/main/paradox/docs/getting-started/running-nexus/search-configuration.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
v1.7.x
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../docs/getting-started/running-nexus/configuration/index.html" title="Nexus configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Nexus configuration
</span>
</div>
</a>
<a href="../../../docs/releases/index.html" title="Releases" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Releases
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Nexus is Open Source and available under the Apache 2 License.<br/>
© 2017-2022 <a href="https://epfl.ch/">EPFL</a>
 <a href="https://bluebrain.epfl.ch/">The Blue Brain Project</a>

</div>
</div>
<div class="md-footer-social">
<a href="https://github.com/BlueBrain" class="md-footer-social__link fa fa-github"></a><a href="https://github.com/BlueBrain/nexus/discussions" class="md-footer-social__link fa fa-github"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../."}})</script>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script src="../../.././public/js/gtm.js"></script>
</body>
</html>
