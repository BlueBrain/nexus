default-sparql-view = "https://bluebrain.github.io/nexus/vocabulary/defaultSparqlIndex"

postgres {
  projects {
    bbp/atlas {
      sparql-view = ${default-sparql-view}
      types = [
        {
          type = "https://neuroshapes.org/AtlasSpatialReferenceSystem"
          queries = [
            {
              table = spatial_reference_system
              ddl =
                """
                  CREATE TABLE IF NOT EXISTS spatial_reference_system (
                    id          VARCHAR NOT NULL UNIQUE,
                    name        VARCHAR NOT NULL,
                    description VARCHAR NOT NULL,
                    rev         INT NOT NULL
                  )
                """
              query =
                """
                  PREFIX nxv:<https://bluebrain.github.io/nexus/vocabulary/>
                  PREFIX nsg:<https://neuroshapes.org/>
                  PREFIX schema:<http://schema.org/>
                  SELECT ?id ?name ?description ?rev
                  WHERE {
                    <{resource_id}> a nsg:AtlasSpatialReferenceSystem .
                    <{resource_id}> schema:name ?name .
                    <{resource_id}> schema:description ?description .
                    <{resource_id}> nxv:self ?self .
                    <{resource_id}> nxv:rev ?rev .
                    BIND("{resource_id}" as ?id) .
                    FILTER(?rev >= {event_rev})
                  }
                  LIMIT 1
                """
            }
          ]
        }
      ]
    }
  }
}