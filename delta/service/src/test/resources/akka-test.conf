akka {
  actor {
    provider = "akka.cluster.ClusterActorRefProvider"
    serialize-messages = on

    serialization-bindings {
      "ch.epfl.bluebrain.nexus.delta.sdk.model.Event" = "kryo"
    }
  }

  remote.artery.canonical.port = 0

  extensions += "akka.cluster.ddata.DistributedData"

  loggers = ["akka.event.slf4j.Slf4jLogger"]
  logging-filter = "akka.event.slf4j.Slf4jLoggingFilter"
  log-dead-letters = on
  loglevel = DEBUG

  persistence {
    journal.plugin = "jdbc-journal"
    snapshot-store.plugin = "jdbc-snapshot-store"
  }
}

jdbc-journal {
  slick = ${h2}
}

jdbc-snapshot-store {
  slick = ${h2}
}

jdbc-read-journal {
  includeLogicallyDeleted = ${akka-persistence-jdbc.logicalDeletion.enable}
  refresh-interval = "10ms"
  max-buffer-size = "500"
  slick = ${h2}
}

akka-kryo-serialization {
  id-strategy = "automatic"
  implicit-registration-logging = true
  resolve-subclasses = false
}

h2 {
  profile = "slick.jdbc.H2Profile$"
  db {
    url = "jdbc:h2:mem:"${test-database}";DATABASE_TO_UPPER=false;"
    driver = "org.h2.Driver"

    // hikariCP
    numThreads = 2 // number of cores
    maxConnections = 3 // 2 * numThreads + 1 (if running on an SSD)
    minConnections = 2  // same as numThreads

    connectionTestQuery = "SELECT 1"
  }
}