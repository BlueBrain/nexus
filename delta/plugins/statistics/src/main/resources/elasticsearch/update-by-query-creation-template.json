{
  "query": {
    "nested": {
      "path": "properties",
      "query": {
        "term": {
          "properties.@id": "{resource_id}"
        }
      }
    }
  },
  "script": {
    "source": "for (prop in ctx._source.properties) {if(prop['@id'] == params.id) {if(ctx._source.relationships == null) ctx._source.relationships = new ArrayList(); prop['@type'] = params.types; } }",
    "lang": "painless",
    "params": {
      "id": "{{resource_id}}",
      "types": [ {{{resource_types}}} ]
    }
  }
}